
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Generalised Linear Models &#8212; TheMulQuaBio</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Fitting using Non-linear Least-squares" href="20-ModelFitting-NLLS.html" />
    <link rel="prev" title="Model simplification" href="18-ModelSimp.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TheMulQuaBio</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-Unix.html">
   UNIX and Linux
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-ShellScripting.html">
   Shell scripting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-Git.html">
   Version control with Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-LaTeX.html">
   Scientific documents with
   <span class="math notranslate nohighlight">
    \(\LaTeX\)
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-Python_I.html">
   Biological Computing in Python I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-R.html">
   Biological Computing in R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-Python_II.html">
   Biological Computing in Python II
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Data Analyses and Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats-Intro.html">
   Introduction to this section
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-Data_R.html">
   Data Management and Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-ExpDesign.html">
   Experimental design and Data exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-t_F_tests.html">
   Basic hypothesis testing:
   <span class="math notranslate nohighlight">
    \(t\)
   </span>
   and
   <span class="math notranslate nohighlight">
    \(F\)
   </span>
   tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14-regress.html">
   Linear Models: Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-anova.html">
   Linear Models: Analysis of variance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16-MulExpl.html">
   Linear Models: Multiple explanatory variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17-MulExplInter.html">
   Linear Models: Multiple variables with interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18-ModelSimp.html">
   Model simplification
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Data Analyses and Statistics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Generalised Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20-ModelFitting-NLLS.html">
   Model Fitting using Non-linear Least-squares
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-JupyIntro.html">
   Introduction to Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Data-Python.html">
   Data analyses  with Python &amp; Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Maths.html">
   Mathematical models in Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Databases.html">
   Databases
   <span class="tocSkip">
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-NLLS-Python.html">
   Model fitting in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-MiniProj.html">
   The Computing Miniproject
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Assessment.html">
   Coursework Assessment
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mhasoba/TheMulQuaBio/master?urlpath=tree/notebooks/19-glm.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio/issues/new?title=Issue%20on%20page%20%2Fnotebooks/19-glm.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/19-glm.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-glm">
   What is a GLM?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-statistical-distributions">
   Some (statistical) distributions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-poisson-distribution">
     The Poisson distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-binomial-distribution">
     The Binomial distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-gamma-distribution">
     The Gamma distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-distributions">
     Other distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-glm-example">
   A GLM example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-exploration">
     Data exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#looking-at-strains-too">
     Looking at strains too
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-linear-model">
     A linear model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-a-glm">
   Fitting a GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overdispersion">
     Overdispersion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-a-glm-using-a-quasi-poisson-distribution">
     Fitting a GLM using a quasi-poisson distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-predictions">
     Model predictions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reporting-the-model">
     Reporting the model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#halos-and-lawns">
   Halos and lawns
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Generalised Linear Models</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-glm">
   What is a GLM?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-statistical-distributions">
   Some (statistical) distributions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-poisson-distribution">
     The Poisson distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-binomial-distribution">
     The Binomial distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-gamma-distribution">
     The Gamma distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-distributions">
     Other distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-glm-example">
   A GLM example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-exploration">
     Data exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#looking-at-strains-too">
     Looking at strains too
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-linear-model">
     A linear model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-a-glm">
   Fitting a GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overdispersion">
     Overdispersion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-a-glm-using-a-quasi-poisson-distribution">
     Fitting a GLM using a quasi-poisson distribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-predictions">
     Model predictions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reporting-the-model">
     Reporting the model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#halos-and-lawns">
   Halos and lawns
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="generalised-linear-models">
<h1>Generalised Linear Models<a class="headerlink" href="#generalised-linear-models" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>Aims of this chapter<a class="reference external" href="#fn1"><span class="math notranslate nohighlight">\(^{[1]}\)</span></a>:</p>
<ul class="simple">
<li><p>Develop an intuitive understanding of generalized linear models</p></li>
<li><p>Learn to fit generalized linear models to count data</p></li>
</ul>
<p>This chapter will step through the analysis carefully. These are not simple analyses so you should concentrate on understanding the process and the biology and think about how to present your results.</p>
</section>
<section id="what-is-a-glm">
<h2>What is a GLM?<a class="headerlink" href="#what-is-a-glm" title="Permalink to this headline">#</a></h2>
<p>Till now, we have adhered faithfully to the assumption of a normal (Gaussian) distribution for the response variable, at times transforming the response variable (e.g., by taking a log) to make it (approximately) normal. However, there are many scenarios where assuming a normal distribution for the response variable is just not appropriate, whether you transform it or not. The generalized linear model (GLM) analysis is (as the name suggests) a generalization of the ordinary linear regression model analysis to accommodate response variables that have non-normal error distributions. These types of (non-normal) response variables can arise quite commonly in the form of count (as in the practical example below) and binary response (present/absent, 0/1, etc.) data, but beyond that, many measures of interest in biology are just not normally distributed.</p>
<p>The GLM generalization of the ordinary Linear Models is made possible by using an (arbitrary) function of the dependent variable (the link function) that makes it vary <em>linearly</em> with the predicted values, thus making the problem relatively tractable statistically. We will not try to understand the mathematical underpinnings of this approach here, but instead learn through an example.</p>
</section>
<section id="some-statistical-distributions">
<h2>Some (statistical) distributions<a class="headerlink" href="#some-statistical-distributions" title="Permalink to this headline">#</a></h2>
<p>First, it’s time to revisit the idea of <em>statistical distributions</em>, which you were introduced to <a class="reference internal" href="12-ExpDesign.html#expdesign-data-types-and-distributions"><span class="std std-ref">previously</span></a>. This is because while analyzing data using GLMs, one needs to decide what particular statistical distribution best represents (or captures, or “model’s”) that particular dataset. For example, continuous numeric data are <em>often</em> normally distributed (e.g., weights of lecturers!). On the other hand, count data are likely to be distributed according to the Poisson distribution (e.g., numbers of plant species found in a sampling plot). And all statistical distribution are actually a <em>family</em> of distributions of different shapes (e.g., can range from right-skewed to bell-shaped) and/or scales (spread) depending upon the value of their <em>parameters</em>. For example, the Gaussian distribution can have different scales depending on the variance parameter. More on distribution parameters below.</p>
<p>There are actually a large number of statistical distributions <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_probability_distributions">out there</a> to choose from. But we will look at a few that GLMs support. Specifically, the <code class="docutils literal notranslate"><span class="pre">glm</span></code> procedure in R supports the following distribution “families”: Binomial, Gaussian, Gamma, Inverse Gaussian, Poisson, Quasi, Quasi-Binomial, and Quasi-Poisson. You may want to look these up online (google it). You have already seen, <a class="reference internal" href="12-ExpDesign.html#expdesign-sampling-from-distributions-in-r"><span class="std std-ref">sampled from</span></a>, and used the Gaussian distribution, so we won’t go into it here. But let’s look at three other distributions that are particularly useful in R.</p>
<section id="the-poisson-distribution">
<h3>The Poisson distribution<a class="headerlink" href="#the-poisson-distribution" title="Permalink to this headline">#</a></h3>
<p>The Poisson distribution family is appropriate for discrete, integer valued data. You can generate “data” that are poisson-distributed by using the function <code class="docutils literal notranslate"><span class="pre">rpois(n,</span> <span class="pre">lambda)</span></code> in R:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rpois</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="m">1</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">rpois</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="m">100</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_3_0.png" src="../_images/19-glm_3_0.png" />
</div>
</div>
<p>The main things to note about these plots (and poisson-distributed data):</p>
<ul class="simple">
<li><p>This distribution is appropriate for response data that can only take integer values, such as counts (technically, only for values of <span class="math notranslate nohighlight">\(\lambda \ge 1\)</span>, but this does not really concern you as far fitting glms in R is concerned).</p></li>
<li><p>A single parameter <span class="math notranslate nohighlight">\(\lambda\)</span> (“lambda”) controls the shape, the scale (the range of the variable) and the location (mean value, or central tendency) of the distribution.</p></li>
<li><p>Thus, this distribution can represent a variety of shapes that count data can take, from right skewed (left plot) to bell-shaped (right plot)  – these variants of shapes and scales make up the Poisson distribution “family”.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Play with the above code and generate different shapes (and inevitably, scales) of poisson-distributed data.</p>
</section>
<section id="the-binomial-distribution">
<h3>The Binomial distribution<a class="headerlink" href="#the-binomial-distribution" title="Permalink to this headline">#</a></h3>
<p>The binomial distribution is appropriate for continuous-valued data that arise from repeated trials of binary (yes/no, 0/1, head/tail, suceptible/resistant) outcomes. This distribution is also the basis for the <a class="reference external" href="https://en.wikipedia.org/wiki/Binomial_test">binomial statistical test</a>. You can generate  binomial-distributed “data” by using the function <code class="docutils literal notranslate"><span class="pre">rbinom(n,</span> <span class="pre">size,</span> <span class="pre">prob)</span></code> in R:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_5_0.png" src="../_images/19-glm_5_0.png" />
</div>
</div>
<p>The main things to note about these plots (and Binomial-distributed data):</p>
<ul class="simple">
<li><p>The two main parameters of interest are <code class="docutils literal notranslate"><span class="pre">size</span></code> (number of trials), and <code class="docutils literal notranslate"><span class="pre">prob</span></code> (the probability of an outcome in each trial). So,</p>
<ul>
<li><p>The left plot is the distribution of outcomes of a single try of a 50:50 (0.5 probability, like a coin-flip) outcome, re-generated 1000 times (e.g., a thousand coin flips) – as expected, there are about 500 each of 0’s and 1’s (e.g., 0 = head, 1 = tail). Each of the 1000 such success/failure experiments is called a Bernoulli trial/experiment. For repeated experiments of a single trial, i.e., <code class="docutils literal notranslate"><span class="pre">size</span></code> = 1 in the R code above, the binomial distribution is a Bernoulli distribution (so the left plot is a bernoulli distribution).</p></li>
<li><p>The right plot is the binomial distribution that you will encounter more often, which is appropriate for modeling the number of successes in a sample of a given size. In the above code, <code class="docutils literal notranslate"><span class="pre">size</span></code> = 100, with 1000 repetitions of this “experiment”). Thus in the right plot, the distribution will on average have a mean value of 50 (<span class="math notranslate nohighlight">\(0.5\times100\)</span> trials) (recall the <a class="reference internal" href="12-ExpDesign.html#expdesign-data-types-and-distributions"><span class="std std-ref">Central Limit Theorem</span></a>).</p></li>
</ul>
</li>
<li><p>Thus, the binomial distribution family is appropriate for binomial <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>, which is a GLM analysis where your sample of binary (yes/no, 0/1, etc) outcomes is fitted as a function of one or more continuous or categorical predictors.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Play with the above code and generate variants of binomial-distributed data distributions. They will all be bell-shaped, but can take different mean and spread values.</p>
</section>
<section id="the-gamma-distribution">
<h3>The Gamma distribution<a class="headerlink" href="#the-gamma-distribution" title="Permalink to this headline">#</a></h3>
<p>The Gamma family is suitable for data that are continuous and can only take values greater than zero (positive values). Another key feature of this distribution family is that the ratio of its variance and mean is constant, so it is appropriate to model data where increasing a mean value also increases the variance as a fixed (constant) factor.  Because of this property, the Gamma family is often used to fit a GLM to response variables that are times, such as waiting time, time between failure, or inverse of the rate of any event, such as an accident.</p>
<p>You can generate  Gamma-distributed “data” by using the function <code class="docutils literal notranslate"><span class="pre">rgamma(n,</span> <span class="pre">shape,</span> <span class="pre">rate)</span></code> in R:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rgamma</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">rgamma</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Value&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_8_0.png" src="../_images/19-glm_8_0.png" />
</div>
</div>
<p>The main things to note about these plots (and Gamma-distributed data):</p>
<ul class="simple">
<li><p>The main parameters of interest are the <code class="docutils literal notranslate"><span class="pre">shape</span></code> and <code class="docutils literal notranslate"><span class="pre">rate</span></code>. The latter controls the distribution’s scale (over what values the distributions spreads).</p></li>
<li><p>This distribution can be right-skewed or bell-shaped, depending on choice of the <code class="docutils literal notranslate"><span class="pre">shape</span></code> parameter.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Play with the above code and generate variants in the gamma-distributed data family.</p>
</section>
<section id="other-distributions">
<h3>Other distributions<a class="headerlink" href="#other-distributions" title="Permalink to this headline">#</a></h3>
<p>There are also the Quasi-binomial and Quasi-poisson families within R’s <code class="docutils literal notranslate"><span class="pre">glm</span></code> procedure, which differ from the Binomial and Poisson families in that the dispersion parameter (variance to mean ratio) is not fixed at one, so that over-dispersion in your data (greater variability than would be expected based on the given statistical model) can be modeled. You will see an example of this below.</p>
<p>Thus, the first and key step while using GLMs is to determine what type of distribution best describes your response variable. We will now try put this and subsequent steps of fitting GLMs.</p>
</section>
</section>
<section id="a-glm-example">
<h2>A GLM example<a class="headerlink" href="#a-glm-example" title="Permalink to this headline">#</a></h2>
<p>We will use mutation data collected in the Genetics Practical by a previous year’s batch.</p>
<p>The students were basically counting colonies looking for mutations. There were a number of bacterial strains which were different mutants of <em>Salmonella</em>. Each group applied a mutagen Nitroguanisine (NG) as well as histidine and streptomycine. A control plate was also tested.</p>
<p>The data file is called <code class="docutils literal notranslate"><span class="pre">PracData.csv</span></code> (so it’s a comma-separated values file), and is available from TheMulQuaBio’s  <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Save the <code class="docutils literal notranslate"><span class="pre">PracData.csv</span></code> dataset into your <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Create a new script called MyGLM.R in your <code class="docutils literal notranslate"><span class="pre">code</span></code> directory. Use the code below to load and check your data.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Start R and change the working directory to <code class="docutils literal notranslate"><span class="pre">code</span></code>, and read in the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">colonies</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;../data/PracData.csv&quot;</span><span class="p">,</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">colonies</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">colonies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	680 obs. of  5 variables:
 $ Student.ID : Factor w/ 34 levels &quot;A1&quot;,&quot;A10&quot;,&quot;A11&quot;,..: 1 1 1 2 2 2 4 4 4 4 ...
 $ Strain     : Factor w/ 5 levels &quot;421&quot;,&quot;712&quot;,&quot;881&quot;,..: 4 3 5 1 2 3 4 2 3 5 ...
 $ Treatment  : Factor w/ 4 levels &quot;Control&quot;,&quot;His&quot;,..: 1 1 1 3 3 1 1 3 3 1 ...
 $ ColonyCount: int  0 0 0 0 0 0 0 0 0 0 ...
 $ HaloLawn   : Factor w/ 2 levels &quot;N&quot;,&quot;Y&quot;: NA NA NA NA NA NA NA NA NA NA ...
</pre></div>
</div>
<div class="output text_html"><table>
<caption>A data.frame: 6 × 5</caption>
<thead>
	<tr><th></th><th scope=col>Student.ID</th><th scope=col>Strain</th><th scope=col>Treatment</th><th scope=col>ColonyCount</th><th scope=col>HaloLawn</th></tr>
	<tr><th></th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>A1 </td><td>899  </td><td>Control</td><td>0</td><td>NA</td></tr>
	<tr><th scope=row>2</th><td>A1 </td><td>881  </td><td>Control</td><td>0</td><td>NA</td></tr>
	<tr><th scope=row>3</th><td>A1 </td><td>TA102</td><td>Control</td><td>0</td><td>NA</td></tr>
	<tr><th scope=row>4</th><td>A10</td><td>421  </td><td>NG     </td><td>0</td><td>NA</td></tr>
	<tr><th scope=row>5</th><td>A10</td><td>712  </td><td>NG     </td><td>0</td><td>NA</td></tr>
	<tr><th scope=row>6</th><td>A10</td><td>881  </td><td>Control</td><td>0</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Now let’s explore the data first.</p>
<section id="data-exploration">
<h3>Data exploration<a class="headerlink" href="#data-exploration" title="Permalink to this headline">#</a></h3>
<p>We have a continuous response variable (<code class="docutils literal notranslate"><span class="pre">ColonyCount</span></code>) and two categorical explanatory variables (<code class="docutils literal notranslate"><span class="pre">Strain</span></code> and <code class="docutils literal notranslate"><span class="pre">Treatment</span></code>). We also have observations of halos and bacterial lawns around the treated areas (<code class="docutils literal notranslate"><span class="pre">HaloLawn</span></code>), which we will come back to at the end of this chapter.</p>
<p>So, with two factors as the explanatory variables, we will use box and whisker plots and boxplots to explore the data. First, we’ll look at the effects of the four treatments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">boxplot</span><span class="p">(</span><span class="n">ColonyCount</span> <span class="o">~</span> <span class="n">Treatment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">colonies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_13_0.png" src="../_images/19-glm_13_0.png" />
</div>
</div>
<p>There are two immediate things to note.</p>
<p>(1) The distributions of colony counts are very <em>skewed</em> — many small counts and a few large counts. We’ve already seen that taking a log of data sometimes works in these cases. However, as the tables above show, we have zero counts for all treatments and <span class="math notranslate nohighlight">\(\log(0)\)</span> is undefined. A common trick is therefore to use <span class="math notranslate nohighlight">\(\log(n+1)\)</span> (add 1 and take a log) when dealing with count data like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">colonies</span><span class="o">$</span><span class="n">logCC</span> <span class="o">&lt;-</span> <span class="nf">log</span><span class="p">(</span><span class="n">colonies</span><span class="o">$</span><span class="n">ColonyCount</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">logCC</span> <span class="o">~</span> <span class="n">Treatment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">colonies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_15_0.png" src="../_images/19-glm_15_0.png" />
</div>
</div>
<p>I hope you’ll agree that this still doesn’t look very convincingly like normal data, but we’ll come back to this point.</p>
<p>(2)  The colony counts are vastly different between the different treatments. It is hard to say for sure from the two plots, but it looks like colonies never grow under the histidine and streptomycine treatments. We can check that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tapply</span><span class="p">(</span><span class="n">colonies</span><span class="o">$</span><span class="n">ColonyCount</span><span class="p">,</span> <span class="n">colonies</span><span class="o">$</span><span class="n">Treatment</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>Control</dt><dd>0</dd><dt>His</dt><dd>0</dd><dt>NG</dt><dd>0</dd><dt>Strep</dt><dd>0</dd></dl>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tapply</span><span class="p">(</span><span class="n">colonies</span><span class="o">$</span><span class="n">ColonyCount</span><span class="p">,</span> <span class="n">colonies</span><span class="o">$</span><span class="n">Treatment</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>Control</dt><dd>2400</dd><dt>His</dt><dd>0</dd><dt>NG</dt><dd>2367</dd><dt>Strep</dt><dd>0</dd></dl>
</div></div>
</div>
<p>There is indeed no variation at all in colony count for histidine and streptomycine — colonies never grow in these treatments. We don’t really need statistics for this observation and, in fact, variation is needed for statistics to work. So, for the rest of this analysis, we will reduce the dataset to the control and nitroguanisine treatments.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Update your script by including the code for these plots.</p>
<p>We’ll use a new piece of code here to get the right subset. <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">%in%</span> <span class="pre">c('a','b','c')</span></code> finds all the entries in <code class="docutils literal notranslate"><span class="pre">var</span></code> whose values are equal to <code class="docutils literal notranslate"><span class="pre">'a'</span></code>, <code class="docutils literal notranslate"><span class="pre">'b'</span></code> OR <code class="docutils literal notranslate"><span class="pre">'c'</span></code>.</p>
<p>This is new syntax, so let’s make sure we understand it. For example, try the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">MyData1</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span> <span class="s">&quot;NG&quot;</span><span class="p">,</span> <span class="s">&quot;NG&quot;</span><span class="p">),</span> <span class="m">4</span><span class="p">)</span>
<span class="n">MyData1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Control'</li><li>'NG'</li><li>'NG'</li><li>'Control'</li><li>'NG'</li><li>'NG'</li><li>'Control'</li><li>'NG'</li><li>'NG'</li><li>'Control'</li><li>'NG'</li><li>'NG'</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">MyData1</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span> <span class="s">&quot;NG&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li></ol>
</div></div>
</div>
<p>This is the same as doing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span> <span class="n">MyData1</span> <span class="o">==</span> <span class="s">&quot;Control&quot;</span> <span class="o">|</span>  <span class="n">MyData1</span> <span class="o">==</span> <span class="s">&quot;NG&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li></ol>
</div></div>
</div>
<p>Note that this is NOT the same as doing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">MyData1</span> <span class="o">==</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span> <span class="s">&quot;NG&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>TRUE</li><li>TRUE</li><li>FALSE</li><li>FALSE</li><li>FALSE</li><li>TRUE</li><li>TRUE</li><li>TRUE</li><li>FALSE</li><li>FALSE</li><li>FALSE</li><li>TRUE</li></ol>
</div></div>
</div>
<p>This is because concatenating the variable names <code class="docutils literal notranslate"><span class="pre">&quot;Control&quot;</span></code> and  <code class="docutils literal notranslate"><span class="pre">&quot;NG&quot;</span></code> using <code class="docutils literal notranslate"><span class="pre">c()</span></code> forces R to match only pairs in that sequence, and not just that, but also only search in successive blocks of two entries. That is why above, the sub-sequence <code class="docutils literal notranslate"><span class="pre">'Control'</span> <span class="pre">'NG'</span> <span class="pre">'NG'</span> <span class="pre">'Control'</span> <span class="pre">'NG'</span></code> still returns <code class="docutils literal notranslate"><span class="pre">TRUE</span> <span class="pre">TRUE</span> <span class="pre">FALSE</span> <span class="pre">FALSE</span> <span class="pre">FALSE</span></code>, as the second occurrence of the pair <code class="docutils literal notranslate"><span class="pre">'Control'</span> <span class="pre">'NG'</span></code> comes in an odd location, following a single <code class="docutils literal notranslate"><span class="pre">'NG'</span></code>.</p>
<p>Now, let’s do the subsetting using <code class="docutils literal notranslate"><span class="pre">%in%</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coloniesCN</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">colonies</span><span class="p">,</span> <span class="n">Treatment</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span> <span class="s">&quot;NG&quot;</span><span class="p">))</span>
<span class="nf">str</span><span class="p">(</span><span class="n">colonies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	680 obs. of  6 variables:
 $ Student.ID : Factor w/ 34 levels &quot;A1&quot;,&quot;A10&quot;,&quot;A11&quot;,..: 1 1 1 2 2 2 4 4 4 4 ...
 $ Strain     : Factor w/ 5 levels &quot;421&quot;,&quot;712&quot;,&quot;881&quot;,..: 4 3 5 1 2 3 4 2 3 5 ...
 $ Treatment  : Factor w/ 4 levels &quot;Control&quot;,&quot;His&quot;,..: 1 1 1 3 3 1 1 3 3 1 ...
 $ ColonyCount: int  0 0 0 0 0 0 0 0 0 0 ...
 $ HaloLawn   : Factor w/ 2 levels &quot;N&quot;,&quot;Y&quot;: NA NA NA NA NA NA NA NA NA NA ...
 $ logCC      : num  0 0 0 0 0 0 0 0 0 0 ...
</pre></div>
</div>
</div>
</div>
<p>Note that this is the same as doing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coloniesCN</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">colonies</span><span class="p">,</span> <span class="n">Treatment</span> <span class="o">==</span> <span class="s">&quot;Control&quot;</span> <span class="o">|</span> <span class="n">Treatment</span> <span class="o">==</span> <span class="s">&quot;NG&quot;</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">coloniesCN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	340 obs. of  6 variables:
 $ Student.ID : Factor w/ 34 levels &quot;A1&quot;,&quot;A10&quot;,&quot;A11&quot;,..: 1 1 1 2 2 2 4 4 4 4 ...
 $ Strain     : Factor w/ 5 levels &quot;421&quot;,&quot;712&quot;,&quot;881&quot;,..: 4 3 5 1 2 3 4 2 3 5 ...
 $ Treatment  : Factor w/ 4 levels &quot;Control&quot;,&quot;His&quot;,..: 1 1 1 3 3 1 1 3 3 1 ...
 $ ColonyCount: int  0 0 0 0 0 0 0 0 0 0 ...
 $ HaloLawn   : Factor w/ 2 levels &quot;N&quot;,&quot;Y&quot;: NA NA NA NA NA NA NA NA NA NA ...
 $ logCC      : num  0 0 0 0 0 0 0 0 0 0 ...
</pre></div>
</div>
</div>
</div>
<p>You’ll see that, although we have removed two treatments, their names still appear in the list of levels in the <code class="docutils literal notranslate"><span class="pre">str</span></code> output. R retains a list of all the levels that were originally in a factor, even when those levels aren’t used any more. This will be annoying later, so
we’ll use the <code class="docutils literal notranslate"><span class="pre">droplevels</span></code> function to strip them out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coloniesCN</span> <span class="o">&lt;-</span> <span class="nf">droplevels</span><span class="p">(</span><span class="n">coloniesCN</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">coloniesCN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data.frame&#39;:	340 obs. of  6 variables:
 $ Student.ID : Factor w/ 34 levels &quot;A1&quot;,&quot;A10&quot;,&quot;A11&quot;,..: 1 1 1 2 2 2 4 4 4 4 ...
 $ Strain     : Factor w/ 5 levels &quot;421&quot;,&quot;712&quot;,&quot;881&quot;,..: 4 3 5 1 2 3 4 2 3 5 ...
 $ Treatment  : Factor w/ 2 levels &quot;Control&quot;,&quot;NG&quot;: 1 1 1 2 2 1 1 2 2 1 ...
 $ ColonyCount: int  0 0 0 0 0 0 0 0 0 0 ...
 $ HaloLawn   : Factor w/ 0 levels: NA NA NA NA NA NA NA NA NA NA ...
 $ logCC      : num  0 0 0 0 0 0 0 0 0 0 ...
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\star\)</span> Add these commands for sub-setting your data to your script file.</p>
</section>
<section id="looking-at-strains-too">
<h3>Looking at strains too<a class="headerlink" href="#looking-at-strains-too" title="Permalink to this headline">#</a></h3>
<p>Now we’ll look to see how counts differ between the strains. A quick and elegant way to visualise this is to use the <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> package to get plots grouped by treatment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">coloniesCN</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Strain</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="n">logCC</span><span class="p">))</span> <span class="o">+</span> 
    <span class="nf">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> <span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span> <span class="o">~</span> <span class="n">Treatment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Removed 46 rows containing non-finite values (stat_boxplot).”
</pre></div>
</div>
<img alt="../_images/19-glm_35_1.png" src="../_images/19-glm_35_1.png" />
</div>
</div>
<p>First impressions from this figure:</p>
<ol class="simple">
<li><p>The strains are doing <em>very</em> different things under the two treatments. Hopefully this now leaps out at you as suggesting that the two variables (Strain and Treatment) are <em>interacting</em>.</p></li>
<li><p>The distributions are still pretty ugly — the variances differ hugely between combinations and four combinations have a median of zero.</p></li>
</ol>
<p>We can also use a barplot of means here. We’ll use the original data to get the means, but can use a log scale on the <span class="math notranslate nohighlight">\(y\)</span> axis (<code class="docutils literal notranslate"><span class="pre">log</span> <span class="pre">=</span> <span class="pre">'y'</span></code>).</p>
<p>Let’s do it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">tapply</span><span class="p">(</span><span class="n">coloniesCN</span><span class="o">$</span><span class="n">ColonyCount</span><span class="p">,</span> <span class="nf">list</span><span class="p">(</span><span class="n">coloniesCN</span><span class="o">$</span><span class="n">Treatment</span><span class="p">,</span> <span class="n">coloniesCN</span><span class="o">$</span><span class="n">Strain</span><span class="p">),</span> <span class="n">mean</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              421        712       881     899    TA102
Control 538.20000 138.866667  12.73077   0.375 126.6875
NG       61.28571   5.517241 292.71429 593.000 523.9000
</pre></div>
</div>
</div>
</div>
<p>And then,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">barplot</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">beside</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span> <span class="s">&#39;y&#39;</span> <span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_39_0.png" src="../_images/19-glm_39_0.png" />
</div>
</div>
<p>Let’s have a go at fitting an ordinary Linear model.</p>
</section>
<section id="a-linear-model">
<h3>A linear model<a class="headerlink" href="#a-linear-model" title="Permalink to this headline">#</a></h3>
<p>We’ll fit a model of colony count as the interaction between strain and treatment and then look at the diagnostic plots. We’d do this anyway, but we’re already suspicious about the variance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">modLM</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">logCC</span> <span class="o">~</span> <span class="n">Strain</span> <span class="o">*</span> <span class="n">Treatment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coloniesCN</span><span class="p">)</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">mgp</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">modLM</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_42_0.png" src="../_images/19-glm_42_0.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(\star\)</span> Include Run this code and have a close look at the plots.</p>
<p>That normal Q-Q plot is not good. Our suspicions were justified and it doesn’t look like we can use a simple log transformation. We’re not even going to look at the <code class="docutils literal notranslate"><span class="pre">anova</span></code> and <code class="docutils literal notranslate"><span class="pre">summary</span></code> tables — if the diagnostic plots are bad enough, then the model outputs are not
to be trusted.</p>
</section>
</section>
<section id="fitting-a-glm">
<h2>Fitting a GLM<a class="headerlink" href="#fitting-a-glm" title="Permalink to this headline">#</a></h2>
<p>In the linear models lecture, we looked at the expectation of <em>constant normal variance</em> in linear models. Whatever the combination of explanatory variables for a particular prediction, the residuals around that prediction have similar variance and are roughly normally distributed. The panel on the left in the figure below illustrates this basic idea.</p>
<hr class="docutils" />
<img src="./graphics/GLMexample.svg" width="700px">
<small> <br><center> Illustration of continuous data that follow a normal distribution (left) versus discrete, count data (right). </center></small>
<hr class="docutils" />
<p>As we have seen, count data do not have this distribution, even when logged. The panel on the right in the above figure shows the expected distribution of count data as the mean count increases with an explanatory variable.</p>
<p>There are three key differences between the two panels of the figure:</p>
<ol class="simple">
<li><p>Counts can <em>never</em> be negative but can be zero.</p></li>
<li><p>Counts are always <em>integers</em> — whole numbers — rather than being continuous.</p></li>
<li><p>The variance of count data is <em>not constant</em>. As the average predicted count gets larger, so does the variance. Unlike the normal distribution, where variance can take any value, for count data the variance is expected to be equal to the mean.</p></li>
</ol>
<p>So, we have data that are unsuitable for a linear model because they do not show constant normal variance. This is where generalised linear models come in — we can change the model for the expected residuals to use a different distribution. For count data, this is the <em>Poisson</em> distribution.</p>
<p>We need to change the function we use to fit models to <code class="docutils literal notranslate"><span class="pre">glm</span></code>, but otherwise the process is very similar. The whole point of the GLM is to model the original count data more appropriately, so we will abandon the logged data too. GLMs can cope with a range of different distributions, so we have to specify the <code class="docutils literal notranslate"><span class="pre">family</span></code> of the distribution we want to use.</p>
<p>So let’s fit a GLM to the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">modPois</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">ColonyCount</span> <span class="o">~</span> <span class="n">Strain</span> <span class="o">*</span> <span class="n">Treatment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coloniesCN</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span> <span class="s">&#39;poisson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we’ll look at the summary table for this model. We have 5 levels of strain and 2 levels of factor in the subset so we get an intercept (<span class="math notranslate nohighlight">\(i\)</span>), 4 differences for strains(<span class="math notranslate nohighlight">\(s_{2-5}\)</span>), one difference for treatment (<span class="math notranslate nohighlight">\(t_2\)</span>) and then four differences for the interaction (<span class="math notranslate nohighlight">\(s_{2-5}t_2\)</span>). These combine like this:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="text-align:left head"><p>Control</p></th>
<th class="text-align:left head"><p>Nitroguanisine</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>421</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i+t_2\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>712</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i + s_2\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i + s_2 + t_2 + s_2 t_2\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>881</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i + s_3\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i+s_3 + t_2 + s_3 t_2\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>889</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( + s_4\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i + s_4 + t_2 + s_4 t_2\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>TA102</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(i + s_5\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( + s_5 + t_2  + s_5 t_2\)</span></p></td>
</tr>
</tbody>
</table>
<p>The summary table looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">modPois</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = ColonyCount ~ Strain * Treatment, family = &quot;poisson&quot;, 
    data = coloniesCN)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-32.370  -10.326   -3.322    0.844   97.840  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              6.28823    0.00787  799.03   &lt;2e-16 ***
Strain712               -1.35472    0.01738  -77.96   &lt;2e-16 ***
Strain881               -3.74421    0.05549  -67.47   &lt;2e-16 ***
Strain899               -7.26906    0.28878  -25.17   &lt;2e-16 ***
StrainTA102             -1.44651    0.01757  -82.34   &lt;2e-16 ***
TreatmentNG             -2.17268    0.02539  -85.57   &lt;2e-16 ***
Strain712:TreatmentNG   -1.05295    0.08446  -12.47   &lt;2e-16 ***
Strain881:TreatmentNG    5.30786    0.06152   86.28   &lt;2e-16 ***
Strain899:TreatmentNG    9.53871    0.28989   32.91   &lt;2e-16 ***
StrainTA102:TreatmentNG  3.59226    0.03090  116.24   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 134445  on 293  degrees of freedom
Residual deviance:  61579  on 284  degrees of freedom
  (46 observations deleted due to missingness)
AIC: 62910

Number of Fisher Scoring iterations: 7
</pre></div>
</div>
</div>
</div>
<p>This looks similar to the <code class="docutils literal notranslate"><span class="pre">summary</span></code> table for a linear model, but with some differences.</p>
<p>Let’s Interpret this table:</p>
<ul class="simple">
<li><p>Under the control treatment, strain 421 (the intercept) has the highest number of colonies and all the other strains have lower numbers to some degree — the differences are
negative.</p></li>
<li><p>The overall effect of nitrogaunasine is to decrease the number of colonies — again a negative coefficient — but then the positive interactions show big increases in colony counts for nitroguanisine for specific strains. Everything is hugely significant.</p></li>
<li><p>Two types of deviance are in the model output. Deviance is a measure of goodness of fit of a GLM. The null deviance shows how well the response variable is predicted by a model that includes only the intercept (overall mean). In our example, we have a value of 134445 on 293 degrees of freedom. Including the independent variables (strain and treatment) decreased the deviance to 61579 points on 284 degrees of freedom (remember, lust like linear models, the df are decreased by the number of parameters minus 1). This is a significant reduction in deviance, so the model fit is significant.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\star\)</span> Copy the code in this section into your script and explore the model a bit more.</p>
<section id="overdispersion">
<h3>Overdispersion<a class="headerlink" href="#overdispersion" title="Permalink to this headline">#</a></h3>
<p>There’s a problem. You may have already spotted it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">mgp</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">0.8</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">modPois</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_48_0.png" src="../_images/19-glm_48_0.png" />
</div>
</div>
<p>Actually, there are two problems. First, that Q-Q plot is still a bit dubious. More of the points are close to the line than in the linear model but there are some extreme positive residuals. Second, the magnitude of the residuals is enormous, and this is really clear in the plot in the bottom right hand corner. This plot identifies outliers and any points outside of the red dotted line are possible problems.</p>
<p>The problem here is <em>overdispersion</em>. The Poisson distribution predicts that the variance at a point in the model is equal to the prediction — the mean count at that point. Our count data shows much more variance than this — particularly that there are some huge counts given the means.</p>
<p>There is a simple way to check the dispersion of count data using the <code class="docutils literal notranslate"><span class="pre">summary</span></code> table: the ratio of the residual deviance to the residual degrees of freedom should be approximately 1. This expectation is actually given in the table:</p>
<p><code class="docutils literal notranslate"><span class="pre">(Dispersion</span> <span class="pre">parameter</span> <span class="pre">for</span> <span class="pre">poisson</span> <span class="pre">family</span> <span class="pre">taken</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">1)</span></code></p>
<p>In this case, the ratio is <span class="math notranslate nohighlight">\(61579/284=216.8\)</span>. That’s very strongly overdispersed. Fortunately, we can allow for this by using a different model.</p>
</section>
<section id="fitting-a-glm-using-a-quasi-poisson-distribution">
<h3>Fitting a GLM using a quasi-poisson distribution<a class="headerlink" href="#fitting-a-glm-using-a-quasi-poisson-distribution" title="Permalink to this headline">#</a></h3>
<p>The quasi-poisson distribution family uses the data to estimate the dispersion of the model, but is otherwise very similar to using the Poisson family. Let’s re-fit the GLM using this distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">modQPois</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">ColonyCount</span> <span class="o">~</span> <span class="n">Strain</span> <span class="o">*</span> <span class="n">Treatment</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">coloniesCN</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#39;quasipoisson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The summary table now looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">modQPois</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = ColonyCount ~ Strain * Treatment, family = &quot;quasipoisson&quot;, 
    data = coloniesCN)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-32.370  -10.326   -3.322    0.844   97.840  

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               6.2882     0.1581  39.784  &lt; 2e-16 ***
Strain712                -1.3547     0.3490  -3.882 0.000129 ***
Strain881                -3.7442     1.1145  -3.359 0.000888 ***
Strain899                -7.2691     5.8000  -1.253 0.211130    
StrainTA102              -1.4465     0.3528  -4.100 5.40e-05 ***
TreatmentNG              -2.1727     0.5100  -4.261 2.78e-05 ***
Strain712:TreatmentNG    -1.0530     1.6964  -0.621 0.535287    
Strain881:TreatmentNG     5.3079     1.2355   4.296 2.39e-05 ***
Strain899:TreatmentNG     9.5387     5.8222   1.638 0.102460    
StrainTA102:TreatmentNG   3.5923     0.6207   5.788 1.88e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for quasipoisson family taken to be 403.3755)

    Null deviance: 134445  on 293  degrees of freedom
Residual deviance:  61579  on 284  degrees of freedom
  (46 observations deleted due to missingness)
AIC: NA

Number of Fisher Scoring iterations: 7
</pre></div>
</div>
</div>
</div>
<p>This is pretty similar to the previous table but there are two differences. First, the dispersion parameter line has changed. Second, all the <span class="math notranslate nohighlight">\(p\)</span> values have got less significant – this is the effect of controlling for the overdispersion.</p>
<p>Let’s look at the model diagnostic plots next:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">mgp</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">0.8</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">modQPois</span><span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19-glm_54_0.png" src="../_images/19-glm_54_0.png" />
</div>
</div>
<p>The residuals and leverage plot is now ok. The Q-Q plot is not better, but is still an improvement over the original linear model. We can’t improve the model fit any more — it isn’t perfect but we’ll accept those imperfections. It is worth thinking about the imperfections though — what might give rise to occasional larger than expected counts of
colonies?</p>
<p>We’ll look at the <code class="docutils literal notranslate"><span class="pre">anova</span></code> table next. Technically, this is now analysis of deviance not analysis of variance but the concept is the same. Different tests are appropriate for different families of distribution, but we can use <span class="math notranslate nohighlight">\(F\)</span> here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">anova</span><span class="p">(</span><span class="n">modQPois</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="s">&quot;F&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A anova: 4 × 6</caption>
<thead>
	<tr><th></th><th scope=col>Df</th><th scope=col>Deviance</th><th scope=col>Resid. Df</th><th scope=col>Resid. Dev</th><th scope=col>F</th><th scope=col>Pr(&gt;F)</th></tr>
	<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>NULL</th><td>NA</td><td>       NA</td><td>293</td><td>134444.90</td><td>       NA</td><td>          NA</td></tr>
	<tr><th scope=row>Strain</th><td> 4</td><td>13923.431</td><td>289</td><td>120521.47</td><td> 8.629323</td><td>1.383092e-06</td></tr>
	<tr><th scope=row>Treatment</th><td> 1</td><td> 6054.662</td><td>288</td><td>114466.81</td><td>15.009988</td><td>1.328328e-04</td></tr>
	<tr><th scope=row>Strain:Treatment</th><td> 4</td><td>52887.715</td><td>284</td><td> 61579.09</td><td>32.778214</td><td>1.790403e-22</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Can we simplify the model? The interaction is the only term we can drop and looks highly significant, but we can check by deleting it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">drop.scope</span><span class="p">(</span><span class="n">modQPois</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'Strain:Treatment'</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">modQPois2</span> <span class="o">&lt;-</span> <span class="nf">update</span><span class="p">(</span><span class="n">modQPois</span><span class="p">,</span> <span class="n">.</span> <span class="o">~</span> <span class="n">.</span> <span class="o">-</span> <span class="n">Strain</span><span class="o">:</span><span class="n">Treatment</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">modQPois</span><span class="p">,</span> <span class="n">modQPois2</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="s">&quot;F&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A anova: 2 × 6</caption>
<thead>
	<tr><th></th><th scope=col>Resid. Df</th><th scope=col>Resid. Dev</th><th scope=col>Df</th><th scope=col>Deviance</th><th scope=col>F</th><th scope=col>Pr(&gt;F)</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>284</td><td> 61579.09</td><td>NA</td><td>       NA</td><td>      NA</td><td>          NA</td></tr>
	<tr><th scope=row>2</th><td>288</td><td>114466.81</td><td>-4</td><td>-52887.72</td><td>32.77821</td><td>1.790403e-22</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>No, that makes the model much worse, so we now have our final model.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Include this new model fitting in your script and check you’ve got the same results.</p>
</section>
<section id="model-predictions">
<h3>Model predictions<a class="headerlink" href="#model-predictions" title="Permalink to this headline">#</a></h3>
<p>We can get model predictions and standard errors using the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function. There is a difference though. GLMs use an internal transformation to model the data using a <em>link function</em> and the coefficients in the summary above are on the scale of the link transformation. The link function defines the relationship between the linear predictor and the mean of the distribution function, so that an otherwise non-linear (non-normal) response can be accommodated. For quasipoisson, the default is a <em>log link</em>, which you can see in the output of <code class="docutils literal notranslate"><span class="pre">anova</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">predict</span></code> to get predictions on the scale of the original <em>response</em>. You can use different link functions than the “canonical” one encoded for each distribution <code class="docutils literal notranslate"><span class="pre">family</span></code>, but covering this is outside the scope of this chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># use expand.grid to get all combinations of factors</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">expand.grid</span><span class="p">(</span><span class="n">Strain</span> <span class="o">=</span> <span class="nf">levels</span><span class="p">(</span><span class="n">coloniesCN</span><span class="o">$</span><span class="n">Strain</span><span class="p">),</span> <span class="n">Treatment</span> <span class="o">=</span> <span class="nf">levels</span><span class="p">(</span><span class="n">coloniesCN</span><span class="o">$</span><span class="n">Treatment</span><span class="p">))</span>

<span class="nf">predict</span><span class="p">(</span><span class="n">modQPois</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;response&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>1</dt><dd>538.200000000001</dd><dt>2</dt><dd>138.866666666667</dd><dt>3</dt><dd>12.7307782005724</dd><dt>4</dt><dd>0.375000000000006</dd><dt>5</dt><dd>126.687499999999</dd><dt>6</dt><dd>61.285714285714</dd><dt>7</dt><dd>5.51724142694226</dd><dt>8</dt><dd>292.714285714285</dd><dt>9</dt><dd>592.999999999998</dd><dt>10</dt><dd>523.899999999999</dd></dl>
</div></div>
</div>
<p>Those are the same values as the means we calculated for the barplot. Adding standard errors to barplots is more difficult for GLMs and we won’t go into it here.</p>
</section>
<section id="reporting-the-model">
<h3>Reporting the model<a class="headerlink" href="#reporting-the-model" title="Permalink to this headline">#</a></h3>
<p>Reporting complicated statistics is a difficult business. There is a lot of detail involved and you want the reader to understand what you have done well enough to repeat the analysis if needed. You also have to summarise and explain the results without pages of R output.</p>
<p>Here are some pointers:</p>
<ul class="simple">
<li><p>What does the data show? Present a graph or a table to show the data you are about to model. <em>Always</em> include a figure or table legend and <em>always</em> refer to that figure or legend from the text.</p></li>
<li><p>Have you transformed the data or used a subset? If so, why?</p></li>
<li><p>What kind of model or statistical test have you used?</p></li>
<li><p>With linear models, what is the response variable and what are the explanatory variables.</p></li>
<li><p>Have you simplified the model and, if so, what was the most complex model you tried?</p></li>
<li><p>How did you check the suitability of the model? Are there any problems with the model and, if so, what might cause them?</p></li>
<li><p>If you summarise stats in text, you must include all the information about the test.</p>
<ul>
<li><p>For <span class="math notranslate nohighlight">\(F\)</span> tests, this is <span class="math notranslate nohighlight">\(F\)</span>, the two degrees of freedom and the p value. For example: ‘There is a significant interaction between treatment and strain (<span class="math notranslate nohighlight">\(F_{4,284}=32.7, p &lt; 0.0001\)</span>)’.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(t\)</span> tests, this is the coefficient, the standard error, <span class="math notranslate nohighlight">\(t\)</span>, the degrees of freedom and <span class="math notranslate nohighlight">\(p\)</span>. For example, ‘Across strains, the main effect of nitroguanisine is to reduce colony counts relative to the control (estimate=-2.17, s.e= 0.51, <span class="math notranslate nohighlight">\(t=-4.26\)</span>, df=284, <span class="math notranslate nohighlight">\(p &lt; 0.0001\)</span>)’.</p></li>
</ul>
</li>
<li><p>With more complex models, it is common to present either the anova table or the coefficients table as a summary of the model output. Just include the tables from R output, not the information around it. See Table 1 for an example.</p></li>
<li><p><em>Never</em> just include chunks of raw output from R.</p></li>
<li><p>Most importantly, you need to convey what the interpretation of the model is. What is it telling you about the data?</p></li>
</ul>
<p><em>Table 1</em>: Coefficients from a GLM of treatment and strain as predictors of colony count.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Estimate</p></th>
<th class="text-align:left head"><p>Std. Error</p></th>
<th class="text-align:left head"><p>t value</p></th>
<th class="text-align:left head"><p>p</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>(Intercept)</p></td>
<td class="text-align:left"><p>6.29</p></td>
<td class="text-align:left"><p>0.16</p></td>
<td class="text-align:left"><p>39.78</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Strain712</p></td>
<td class="text-align:left"><p>-1.35</p></td>
<td class="text-align:left"><p>0.35</p></td>
<td class="text-align:left"><p>-3.88</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Strain881</p></td>
<td class="text-align:left"><p>-3.74</p></td>
<td class="text-align:left"><p>1.11</p></td>
<td class="text-align:left"><p>-3.36</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Strain899</p></td>
<td class="text-align:left"><p>-7.27</p></td>
<td class="text-align:left"><p>5.80</p></td>
<td class="text-align:left"><p>-1.25</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>StrainTA102</p></td>
<td class="text-align:left"><p>-1.45</p></td>
<td class="text-align:left"><p>0.35</p></td>
<td class="text-align:left"><p>-4.10</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>TreatmentNG</p></td>
<td class="text-align:left"><p>-2.17</p></td>
<td class="text-align:left"><p>0.51</p></td>
<td class="text-align:left"><p>-4.26</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Strain712:TreatmentNG</p></td>
<td class="text-align:left"><p>-1.05</p></td>
<td class="text-align:left"><p>1.70</p></td>
<td class="text-align:left"><p>-0.62</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Strain881:TreatmentNG</p></td>
<td class="text-align:left"><p>5.31</p></td>
<td class="text-align:left"><p>1.24</p></td>
<td class="text-align:left"><p>4.30</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Strain899:TreatmentNG</p></td>
<td class="text-align:left"><p>9.54</p></td>
<td class="text-align:left"><p>5.82</p></td>
<td class="text-align:left"><p>1.64</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>StrainTA102:TreatmentNG</p></td>
<td class="text-align:left"><p>3.59</p></td>
<td class="text-align:left"><p>0.62</p></td>
<td class="text-align:left"><p>5.79</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="halos-and-lawns">
<h2>Halos and lawns<a class="headerlink" href="#halos-and-lawns" title="Permalink to this headline">#</a></h2>
<p>We’ll keep this one simple since it is harder to analyse. The response variable (<code class="docutils literal notranslate"><span class="pre">HaloLawn</span></code>) is binary — the plates either have a lawn or not. We’ll just look at a contingency table of how many plates have halos or lawns under each combination of treatment and strain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">table</span><span class="p">(</span><span class="n">Halo</span> <span class="o">=</span> <span class="n">colonies</span><span class="o">$</span><span class="n">HaloLawn</span><span class="p">,</span> <span class="n">Strain</span> <span class="o">=</span> <span class="n">colonies</span><span class="o">$</span><span class="n">Strain</span><span class="p">,</span> <span class="n">Treatment</span> <span class="o">=</span>  <span class="n">colonies</span><span class="o">$</span><span class="n">Treatment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>, , Treatment = Control

    Strain
Halo 421 712 881 899 TA102
   N   0   0   0   0     0
   Y   0   0   0   0     0

, , Treatment = His

    Strain
Halo 421 712 881 899 TA102
   N   1   1   0   0     1
   Y  29  29  26  32    31

, , Treatment = NG

    Strain
Halo 421 712 881 899 TA102
   N   0   0   0   0     0
   Y   0   0   0   0     0

, , Treatment = Strep

    Strain
Halo 421 712 881 899 TA102
   N   5  30   5  21     0
   Y  25   0  25   9    32
</pre></div>
</div>
</div>
</div>
<p>So, lawns and halos are never recorded from nitroguanisine or the control. They’re nearly always found with histidine and different strains have different response to streptomysin. Again, treatment and strain interact. Although you can use a <span class="math notranslate nohighlight">\(\chi^2\)</span> test with two-dimensional contingency tables to look for independence between factors, you can’t with a three-way table without using more specialized tests.</p>
<p>We will not go any further into this, but be aware that such gnarly statistical challenges may arise at times!</p>
<hr class="docutils" />
<p><a id="fn1"></a>
[1]: Here you will work with the script file <code class="docutils literal notranslate"><span class="pre">glm.R</span></code></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="18-ModelSimp.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Model simplification</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="20-ModelFitting-NLLS.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model Fitting using Non-linear Least-squares</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Samraat Pawar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>