
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Biological Computing in Python II &#8212; TheMulQuaBio</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction to this section" href="../Stats-Intro.html" />
    <link rel="prev" title="Biological Computing in R" href="07-R.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TheMulQuaBio</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-Unix.html">
   UNIX and Linux
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-ShellScripting.html">
   Shell scripting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-Git.html">
   Version control with Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-LaTeX.html">
   Scientific documents with
   <span class="math notranslate nohighlight">
    \(\LaTeX\)
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-Python_I.html">
   Biological Computing in Python I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-R.html">
   Biological Computing in R
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Biological Computing in Python II
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Data Analyses and Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats-Intro.html">
   Introduction to this section
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-Data_R.html">
   Data Management and Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-ExpDesign.html">
   Experimental design and Data exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-t_F_tests.html">
   Basic hypothesis testing:
   <span class="math notranslate nohighlight">
    \(t\)
   </span>
   and
   <span class="math notranslate nohighlight">
    \(F\)
   </span>
   tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14-regress.html">
   Linear Models: Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-anova.html">
   Linear Models: Analysis of variance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16-MulExpl.html">
   Linear Models: Multiple explanatory variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17-MulExplInter.html">
   Linear Models: Multiple variables with interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18-ModelSimp.html">
   Model simplification
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Data Analyses and Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="19-glm.html">
   Generalised Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20-ModelFitting-NLLS.html">
   Model Fitting using Non-linear Least-squares
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-JupyIntro.html">
   Introduction to Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Data-Python.html">
   Data analyses  with Python &amp; Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Maths.html">
   Mathematical models in Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Databases.html">
   Databases
   <span class="tocSkip">
   </span>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-NLLS-Python.html">
   Model fitting in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-MiniProj.html">
   The Computing Miniproject
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix-Assessment.html">
   Coursework Assessment
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mhasoba/TheMulQuaBio/master?urlpath=tree/notebooks/06-Python_II.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mhasoba/TheMulQuaBio/issues/new?title=Issue%20on%20page%20%2Fnotebooks/06-Python_II.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/06-Python_II.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-computing-in-python">
   Numerical computing in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy">
     Numpy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#indexing-and-accessing-arrays">
     Indexing and accessing arrays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-arrays">
     Manipulating arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replacing-adding-or-deleting-elements">
       Replacing, adding or deleting elements
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#flattening-or-reshaping-arrays">
       Flattening or reshaping arrays
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-allocating-arrays">
     Pre-allocating arrays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-matrices">
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
     matrices
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#matrix-vector-operations">
       Matrix-vector operations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-scipy-package">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy
      </span>
     </code>
     package
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scipy-stats">
       Scipy stats
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numerical-integration-using-scipy">
       Numerical integration using
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#area-under-a-curve">
         Area under a curve
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#the-lotka-volterra-model">
         The Lotka-Volterra model
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practicals">
     Practicals
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-need-for-speed-profiling-code">
     The need for speed: profiling code
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#profiling">
       Profiling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#profiling-without-ipython">
       Profiling without ipython
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quick-profiling-with-timeit">
       Quick profiling with
       <code class="docutils literal notranslate">
        <span class="pre">
         timeit
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vectorization-revisited">
     Vectorization revisited
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-example">
       An example
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#when-to-vectorize">
       When to vectorize?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#no-free-lunch">
       “No free lunch!”
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lotka-volterra-model-problem">
       Lotka-Volterra model problem
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-compare-r-and-python-vectorization">
       Groupwork practical: Compare R and Python Vectorization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-discrete-time-lv-model">
       Groupwork practical: Discrete time LV Model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-discrete-time-lv-model-with-stochasticity">
       Groupwork practical: Discrete time LV model with stochasticity
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regular-expressions-in-python">
   Regular expressions in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#metacharacters-vs-regular-characters">
     Metacharacters vs. regular characters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regex-special-sequences">
     Regex special sequences
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-regex-examples">
     Some regex examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regex-in-python">
     Regex in Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practicals-some-regexercises">
     Practicals: Some RegExercises
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping-regex-patterns">
     Grouping regex patterns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#useful-re-commands">
     Useful
     <code class="docutils literal notranslate">
      <span class="pre">
       re
      </span>
     </code>
     commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-all-matches">
     Finding all matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-in-files">
     Finding in files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groups-within-multiple-matches">
     Groups within multiple matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-text-from-webpages">
     Extracting text from webpages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replacing-text">
     Replacing text
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#blackbirds-problem">
       Blackbirds problem
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-python-to-build-workflows">
   Using Python to build workflows
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-subprocess">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       subprocess
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-processes">
       Running processes
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#handling-directory-and-file-paths">
     Handling directory and file paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-r">
     Running
     <code class="docutils literal notranslate">
      <span class="pre">
       R
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-os-problem-1">
       Using
       <code class="docutils literal notranslate">
        <span class="pre">
         os
        </span>
       </code>
       problem 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-os-problem-2">
       Using
       <code class="docutils literal notranslate">
        <span class="pre">
         os
        </span>
       </code>
       problem 2
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#networks-in-python">
   Networks in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#food-web-network-example">
     Food web network example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-the-foodweb">
       Plot the foodweb
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-networks-in-r">
       Groupwork: networks in R
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#readings-and-resources">
   Readings and Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scientific-computing">
     Scientific computing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regular-expressions">
     Regular expressions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-stuff">
     Other stuff
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Biological Computing in Python II</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-computing-in-python">
   Numerical computing in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy">
     Numpy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#indexing-and-accessing-arrays">
     Indexing and accessing arrays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-arrays">
     Manipulating arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replacing-adding-or-deleting-elements">
       Replacing, adding or deleting elements
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#flattening-or-reshaping-arrays">
       Flattening or reshaping arrays
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-allocating-arrays">
     Pre-allocating arrays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-matrices">
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
     matrices
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#matrix-vector-operations">
       Matrix-vector operations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-scipy-package">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy
      </span>
     </code>
     package
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scipy-stats">
       Scipy stats
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numerical-integration-using-scipy">
       Numerical integration using
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#area-under-a-curve">
         Area under a curve
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#the-lotka-volterra-model">
         The Lotka-Volterra model
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practicals">
     Practicals
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-need-for-speed-profiling-code">
     The need for speed: profiling code
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#profiling">
       Profiling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#profiling-without-ipython">
       Profiling without ipython
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quick-profiling-with-timeit">
       Quick profiling with
       <code class="docutils literal notranslate">
        <span class="pre">
         timeit
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vectorization-revisited">
     Vectorization revisited
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-example">
       An example
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#when-to-vectorize">
       When to vectorize?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#no-free-lunch">
       “No free lunch!”
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lotka-volterra-model-problem">
       Lotka-Volterra model problem
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-compare-r-and-python-vectorization">
       Groupwork practical: Compare R and Python Vectorization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-discrete-time-lv-model">
       Groupwork practical: Discrete time LV Model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-practical-discrete-time-lv-model-with-stochasticity">
       Groupwork practical: Discrete time LV model with stochasticity
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regular-expressions-in-python">
   Regular expressions in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#metacharacters-vs-regular-characters">
     Metacharacters vs. regular characters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regex-special-sequences">
     Regex special sequences
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-regex-examples">
     Some regex examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regex-in-python">
     Regex in Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practicals-some-regexercises">
     Practicals: Some RegExercises
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping-regex-patterns">
     Grouping regex patterns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#useful-re-commands">
     Useful
     <code class="docutils literal notranslate">
      <span class="pre">
       re
      </span>
     </code>
     commands
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-all-matches">
     Finding all matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-in-files">
     Finding in files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groups-within-multiple-matches">
     Groups within multiple matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-text-from-webpages">
     Extracting text from webpages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replacing-text">
     Replacing text
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#blackbirds-problem">
       Blackbirds problem
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-python-to-build-workflows">
   Using Python to build workflows
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-subprocess">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       subprocess
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-processes">
       Running processes
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#handling-directory-and-file-paths">
     Handling directory and file paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-r">
     Running
     <code class="docutils literal notranslate">
      <span class="pre">
       R
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-os-problem-1">
       Using
       <code class="docutils literal notranslate">
        <span class="pre">
         os
        </span>
       </code>
       problem 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-os-problem-2">
       Using
       <code class="docutils literal notranslate">
        <span class="pre">
         os
        </span>
       </code>
       problem 2
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#networks-in-python">
   Networks in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#food-web-network-example">
     Food web network example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Practicals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-the-foodweb">
       Plot the foodweb
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#groupwork-networks-in-r">
       Groupwork: networks in R
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#readings-and-resources">
   Readings and Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scientific-computing">
     Scientific computing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regular-expressions">
     Regular expressions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-stuff">
     Other stuff
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="biological-computing-in-python-ii">
<h1>Biological Computing in Python II<a class="headerlink" href="#biological-computing-in-python-ii" title="Permalink to this headline">#</a></h1>
<blockquote class="epigraph">
<div><p>…some things in life are bad. They can really make you mad. Other things just make you swear and curse. When you’re chewing on life’s gristle, don’t grumble; give a whistle, and this’ll help things turn out for the best. And… always look on the bright side of life…</p>
<p class="attribution">—Monty Python
</p>
</div></blockquote>
<p>In this chapter, we will build on the <a class="reference internal" href="05-Python_I.html"><span class="doc std std-doc">first Python Chapter</span></a>, covering some more advanced topics.</p>
<section id="numerical-computing-in-python">
<h2>Numerical computing in Python<a class="headerlink" href="#numerical-computing-in-python" title="Permalink to this headline">#</a></h2>
<p>Python is a good choice for numerical computing (recall <a class="reference internal" href="05-Python_I.html#python-i-why-python"><span class="std std-ref">this comparison</span></a>). Using the right packages, you can do some serious number crunching in Python.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code> packages. The latter offers a data structure called numpy array that is suitable for efficient computing, along with basic operations on these arrays.</p>
<p>On the other hand, scipy is proper numerical computing package (which <em>uses</em> numpy arrays) that can do a lot of things, including:</p>
<ul class="simple">
<li><p>Linear algebra (matrix and vector operations) using <code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code></p></li>
<li><p>Dealing with sparse matrix problems using <code class="docutils literal notranslate"><span class="pre">scipy.sparse</span></code></p></li>
<li><p>Numerical integration (including solving of Ordinary Differential Equations (ODEs)) using <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code></p></li>
<li><p>Random number generation and using statistical functions and transformations using <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code></p></li>
<li><p>Optimization using <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code></p></li>
<li><p>Fourier transforms using <code class="docutils literal notranslate"><span class="pre">scipy.fft</span></code></p></li>
<li><p>Signal Processing using <code class="docutils literal notranslate"><span class="pre">scipy.signal</span></code></p></li>
</ul>
<p>We will learn more about scipy further below. First, let’s start with <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p>
<section id="numpy">
<h3>Numpy<a class="headerlink" href="#numpy" title="Permalink to this headline">#</a></h3>
<p>Numpy provides the <code class="docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">array</span></code> data structure, along with methods for for data creation, manipulations and basic numerical calculations. Numpy arrays are similar in some respects to Python lists, but are homogeneous in type (the default is float), allow efficient (fast) manipulations, and are more naturally multidimensional (e.g., you can store multiple matrices in one array).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>numpy arrays are analogous to the <a class="reference internal" href="07-R.html#r-matrices"><span class="std std-ref">R <code class="docutils literal notranslate"><span class="pre">matrix</span></code></span></a> data structure.</p>
</div>
<p>Let’s start by importing numpy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c1"># a one-dimensional array</span>
<span class="n">a</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 3, 4])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;numpy.ndarray&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;numpy.int64&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Thus the last two outputs tell you that firstly, that numpy arrays belong to a data structure type (and a class) called <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, and secondly, that at position <code class="docutils literal notranslate"><span class="pre">0</span></code> (remember, Python indexing starts at 0) it holds an <a class="reference external" href="https://en.wikipedia.org/wiki/9,223,372,036,854,775,807">64 bit integer</a>. All elements in <code class="docutils literal notranslate"><span class="pre">a</span></code> are of type <code class="docutils literal notranslate"><span class="pre">int</span></code> because that is what <code class="docutils literal notranslate"><span class="pre">range()</span></code> returns (try <code class="docutils literal notranslate"><span class="pre">?range</span></code>).</p>
<hr class="docutils" />
<figure class="align-default" id="python-numpy-array">
<a class="reference internal image-reference" href="../_images/numpyarray.png"><img alt="Python numpy array" src="../_images/numpyarray.png" style="width: 700px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text"><strong>A graphical depiction of numpy/numpy arrays.</strong> These can have multiple dimensions (even greater than 3). <br>
(Source: <a class="reference external" href="http://pages.physics.cornell.edu/~myers/teaching/ComputationalMethods/python/arrays.html">http://pages.physics.cornell.edu/~myers/teaching/ComputationalMethods/python/arrays.html</a>)</span><a class="headerlink" href="#python-numpy-array" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>You can also specify the data type of the array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">a</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0., 1., 2., 3., 4.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span> <span class="c1"># Check type </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;float64&#39;)
</pre></div>
</div>
</div>
</div>
<p>You can also get a 1-D arrays as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 3, 4])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span> <span class="c1">#directly specify float using decimal</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0., 1., 2., 3., 4.])
</pre></div>
</div>
</div>
</div>
<p>As with other Python variables (e.g., created as a list or a dictionary), you can apply methods to variables created as numpy arrays. For example, type <code class="docutils literal notranslate"><span class="pre">x.</span></code> and hit TAB to see all methods you can apply to<code class="docutils literal notranslate"><span class="pre">x</span></code>. To see dimensions of <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5,)
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember, you can type <code class="docutils literal notranslate"><span class="pre">:?x.methodname</span></code> to get info on a particular method (command). For example, try <code class="docutils literal notranslate"><span class="pre">?x.shape</span></code>.</p>
</div>
<p>You can also convert to and from Python lists (recall <a class="reference internal" href="05-Python_I.html#python-comprehensions"><span class="std std-ref">list comprehensions</span></a> from the <a class="reference internal" href="05-Python_I.html"><span class="doc std std-doc">Python I chapter</span></a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">#odd numbers between 1 and 10 </span>
<span class="n">b</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 3, 5, 7, 9])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1">#convert back to list</span>
<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 3, 5, 7, 9]
</pre></div>
</div>
</div>
</div>
<p>To make a matrix, you need a 2-D numpy array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="n">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 1],
       [2, 3]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 2)
</pre></div>
</div>
</div>
</div>
</section>
<section id="indexing-and-accessing-arrays">
<h3>Indexing and accessing arrays<a class="headerlink" href="#indexing-and-accessing-arrays" title="Permalink to this headline">#</a></h3>
<p>As with other Python data objects such as lists, numpy array elements can be accessed using square brackets (<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>) with the usual <code class="docutils literal notranslate"><span class="pre">[row,column]</span></code> reference. Indexing of numpy arrays works like that for other data structures, with index values starting at 0. So, you can obtain all the elements of a particular row as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># accessing whole 2nd row, remember indexing starts at  0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#accessing whole second column  </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 3])
</pre></div>
</div>
</div>
</div>
<p>And accessing particular elements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 1st row, 1st column element</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 2nd row, 1st column element</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>Note that (like all other programming languages) row index always comes before column index. That is, <code class="docutils literal notranslate"><span class="pre">mat[1]</span></code> is always going to mean “whole second row”, and <code class="docutils literal notranslate"><span class="pre">mat[1,1]</span></code> means 1st row and 1st column element. Therefore, to access the whole second column, you need:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#accessing whole first column  </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 2])
</pre></div>
</div>
</div>
</div>
<p>Python indexing also accepts negative values for going back to the start
from the end of an array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>Very interesting, but rather useless for this simple matrix!</p>
</section>
<section id="manipulating-arrays">
<h3>Manipulating arrays<a class="headerlink" href="#manipulating-arrays" title="Permalink to this headline">#</a></h3>
<p>Manipulating numpy arrays is pretty straightforward.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Why numpy arrays are computationally efficient:</strong>  The data associated with a numpy array object (its metadata  – number of dimensions, shape, data type, etc – as well as the actual data) are stored in a homogeneous and contiguous block of memory (a “data buffer”), at a particular address in the system’s RAM (Random Access Memory). This makes numpy arrays more efficient than a pure Python data structures like lists whose data are scattered across the system memory.</p>
</div>
<section id="replacing-adding-or-deleting-elements">
<h4>Replacing, adding or deleting elements<a class="headerlink" href="#replacing-adding-or-deleting-elements" title="Permalink to this headline">#</a></h4>
<p>Let’s look at how you can replace, add, or delete an array element (a single entry, or whole row(s) or whole column(s)):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#replace a single element</span>
<span class="n">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1,  1],
       [ 2,  3]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span> <span class="c1">#replace whole column</span>
<span class="n">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12,  1],
       [12,  3]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="p">[[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">]],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">#append row, note axis specification</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12,  1],
       [12,  3],
       [12, 12]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="p">[[</span><span class="mi">12</span><span class="p">],[</span><span class="mi">12</span><span class="p">]],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#append column</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12,  1, 12],
       [12,  3, 12]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newRow</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">]]</span> <span class="c1">#create new row</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">newRow</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">#append that existing row</span>
<span class="n">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12,  1],
       [12,  3],
       [12, 12]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">#Delete 3rd row</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12,  1],
       [12,  3]])
</pre></div>
</div>
</div>
</div>
<p>And concatenation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="n">mat0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">mat</span><span class="p">,</span> <span class="n">mat0</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  1],
       [ 2,  3],
       [ 0, 10],
       [-1,  3]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="flattening-or-reshaping-arrays">
<h4>Flattening or reshaping arrays<a class="headerlink" href="#flattening-or-reshaping-arrays" title="Permalink to this headline">#</a></h4>
<p>You can also “flatten” or “melt” arrays, that is, change array dimensions (e.g., from a matrix to a vector):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0],
       [1],
       [2],
       [3]])
</pre></div>
</div>
</div>
</div>
<p>This is different from ravel: check the documentation by using <code class="docutils literal notranslate"><span class="pre">?np.reshape</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 1, 2, 3]])
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might have noticed that flattening and reshaping is “row-priority”: elements of the vector are allocated to a matrix row-wise, and vice versa(e.g., with <code class="docutils literal notranslate"><span class="pre">ravel</span></code> unraveling also happens row by row).</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">173</span><span class="o">-</span><span class="mi">87</span><span class="n">bbd101e41a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="ne">ValueError</span>: cannot reshape array of size 4 into shape (3,1)
</pre></div>
</div>
</div>
</div>
<p>This gives an error because total elements must remain the same!</p>
<p>This is a bit different than how <a class="reference internal" href="07-R.html#r-recycling"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">R</span></code> behaves</span></a>, where you won’t get an error (R “recycles” data) (which can be dangerous!)</p>
</section>
</section>
<section id="pre-allocating-arrays">
<h3>Pre-allocating arrays<a class="headerlink" href="#pre-allocating-arrays" title="Permalink to this headline">#</a></h3>
<p>As in other computer languages, it is usually more efficient to preallocate an array rather than append / insert / concatenate additional elements, rows, or columns. <em>Why</em>? – because you might run out of contiguous space in the specific system memory (RAM) address where the current array is stored. Preallocation allocates all the RAM memory you need in one call, while resizing the array (through <code class="docutils literal notranslate"><span class="pre">append</span></code>, <code class="docutils literal notranslate"><span class="pre">insert</span></code>, <code class="docutils literal notranslate"><span class="pre">concatenate</span></code>, <code class="docutils literal notranslate"><span class="pre">resize</span></code>, etc.) may require copying the array to a larger block of memory, slowing things down, and significantly so if the matrix/array is very large.</p>
<p>For example, if you know the size of your matrix or array, you can initialize it with ones or zeros:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1">#(4,2) are the (row,col) array dimensions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1.],
       [1., 1.],
       [1., 1.],
       [1., 1.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># or zeros</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#create an identity matrix</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 0., 0., 0.],
       [0., 1., 0., 0.],
       [0., 0., 1., 0.],
       [0., 0., 0., 1.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="c1">#fill the matrix with 16</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[16., 16., 16., 16.],
       [16., 16., 16., 16.],
       [16., 16., 16., 16.],
       [16., 16., 16., 16.]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="numpy-matrices">
<h3><code class="docutils literal notranslate"><span class="pre">numpy</span></code> matrices<a class="headerlink" href="#numpy-matrices" title="Permalink to this headline">#</a></h3>
<p>Scipy/Numpy also has a <code class="docutils literal notranslate"><span class="pre">matrix</span></code> data structure class. Numpy matrices are strictly 2-dimensional, while numpy arrays are N-dimensional. Matrix objects are a subclass of numpy arrays, so they inherit all the attributes and methods of numpy arrays (ndarrays).</p>
<p>The main advantage of scipy matrices is that they provide a convenient notation for matrix multiplication: for example, if <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are matrices, then <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span></code> is their matrix product.</p>
<section id="matrix-vector-operations">
<h4>Matrix-vector operations<a class="headerlink" href="#matrix-vector-operations" title="Permalink to this headline">#</a></h4>
<p>Now let’s perform some common matrix-vector operations on arrays (you can also try the same using matrices instead of arrays):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#Convert to matrix</span>
<span class="n">mm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11],
       [12, 13, 14, 15]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  4,  8, 12],
       [ 1,  5,  9, 13],
       [ 2,  6, 10, 14],
       [ 3,  7, 11, 15]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">+</span> <span class="n">mm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  5, 10, 15],
       [ 5, 10, 15, 20],
       [10, 15, 20, 25],
       [15, 20, 25, 30]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">-</span> <span class="n">mm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0, -3, -6, -9],
       [ 3,  0, -3, -6],
       [ 6,  3,  0, -3],
       [ 9,  6,  3,  0]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">*</span> <span class="n">mm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="c1"># Note that this is element-wise multiplication</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  0,   4,  16,  36],
       [  4,  25,  54,  91],
       [ 16,  54, 100, 154],
       [ 36,  91, 154, 225]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">//</span> <span class="n">mm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-183-2d8eab61478f&gt;:1: RuntimeWarning: divide by zero encountered in floor_divide
  mm // mm.transpose()
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 0, 0, 0],
       [4, 1, 0, 0],
       [4, 1, 1, 0],
       [4, 1, 1, 1]])
</pre></div>
</div>
</div>
</div>
<p>Note that we used integer division <code class="docutils literal notranslate"><span class="pre">//</span></code>. Note also the warning you get (because of zero division). So let’s avoid the divide by zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">//</span> <span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 0, 0, 0],
       [2, 0, 0, 0],
       [2, 1, 0, 0],
       [3, 1, 1, 0]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.        ,  3.14159265,  6.28318531,  9.42477796],
       [12.56637061, 15.70796327, 18.84955592, 21.99114858],
       [25.13274123, 28.27433388, 31.41592654, 34.55751919],
       [37.69911184, 40.8407045 , 43.98229715, 47.1238898 ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="c1"># No this is matric multiplication, or the dot product</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 56,  62,  68,  74],
       [152, 174, 196, 218],
       [248, 286, 324, 362],
       [344, 398, 452, 506]])
</pre></div>
</div>
</div>
</div>
<p>There is also a numpy matrix class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="c1"># convert to scipy/numpy matrix class</span>
<span class="n">mm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>matrix([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11],
        [12, 13, 14, 15]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;numpy.matrix&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>This data structure makes matrix multiplication syntactically easier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">*</span> <span class="n">mm</span> <span class="c1"># instead of mm.dot(mm)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>matrix([[ 56,  62,  68,  74],
        [152, 174, 196, 218],
        [248, 286, 324, 362],
        [344, 398, 452, 506]])
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>However, it is not recommended that you use the numpy matrix class because it may be removed <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.matrix.html">in the future</a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can do a lot more with matrices and vectors by importing the <code class="docutils literal notranslate"><span class="pre">linalg</span></code> sub-package from scipy: <code class="docutils literal notranslate"><span class="pre">scipy.linalg</span></code>.</p>
</div>
</section>
</section>
<section id="the-scipy-package">
<h3>The <code class="docutils literal notranslate"><span class="pre">scipy</span></code> package<a class="headerlink" href="#the-scipy-package" title="Permalink to this headline">#</a></h3>
<p>Now let’s move on to <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>scipy vs numpy</strong>: It’s a bit confusing. Please have a look at <a class="reference external" href="https://www.scipy.org/scipylib/faq.html#what-is-the-difference-between-numpy-and-scipy">this</a> and <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/release.1.4.0.html#scipy-deprecations">this</a>. Basically, there is some overlap between what these two packages can do, and this redundancy will eventually be phased out completely. The recommended approach is to use numpy for creating and manipulating data and scipy for more complex numerical operations.</p>
</div>
<p>We will look at two particularly useful <code class="docutils literal notranslate"><span class="pre">scipy</span></code> sub-packages here: <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code>.</p>
<section id="scipy-stats">
<span id="python-scipy-stats"></span><h4>Scipy stats<a class="headerlink" href="#scipy-stats" title="Permalink to this headline">#</a></h4>
<p>Let’s take a quick spin in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>.</p>
<p><em>Why not use <code class="docutils literal notranslate"><span class="pre">R</span></code> for stats?</em> — because often you might just need to calculate some summary stats of your simulation results within Python, or you simulations may require the generation of random numbers.</p>
<p>First, import scipy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sc</span>
</pre></div>
</div>
</div>
</div>
<p>Or you can use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">scipy</span> <span class="pre">import</span> <span class="pre">stats</span></code>.</p>
<p>Let’s generate 10 samples from the normal distribution (<span class="math notranslate nohighlight">\(\mathcal{N}(\mu,\,\sigma^{2})\)</span>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.40545341,  0.28909194,  1.32115819, -1.54690555, -0.20264632,
       -0.65596934,  0.19342138,  0.55343891,  1.31815155, -0.46930528])
</pre></div>
</div>
</div>
</div>
<p>By default, <a class="reference internal" href="07-R.html#r-random-numbers"><span class="std std-ref">as in R</span></a>, these are numbers from the <em>standard</em> normal distribution (<span class="math notranslate nohighlight">\(\mathcal{N}(0,\,1)\)</span>).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Continuing on the numpy vs scipy theme</strong>: Both scipy and numpy can generate random numbers (e.g., <code class="docutils literal notranslate"><span class="pre">np.random.normal(size=10)</span></code> would work equally well above). In fact, scipy uses the <code class="docutils literal notranslate"><span class="pre">numpy.random</span></code> package under the hood for drawing random numbers. You may choose to use either, but for sanity, its probably a good idea to just stick with <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> for all your stats number crunching.</p>
</div>
<p>Also, as you learned <a class="reference internal" href="07-R.html#r-random-numbers"><span class="std std-ref">in R</span></a>, you can “seed” random numbers to get the same sequence every time (important for reproducibility – when you need to know what specific random numbers were input into a particular program routine or algorithm).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.47143516, -1.19097569,  1.43270697, -0.3126519 , -0.72058873,
        0.88716294,  0.85958841, -0.6365235 ,  0.01569637, -2.24268495])
</pre></div>
</div>
</div>
</div>
<p>But setting a <em>global</em> random number state is not always needed or in some many cases, recommended, because using something like <code class="docutils literal notranslate"><span class="pre">np.random.seed(1234)</span></code> will set the seed for all following instances where a random number is generated. In many scenarios a more robust way is to use the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> argument for each specific generation of a set of random numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.47143516, -1.19097569,  1.43270697, -0.3126519 , -0.72058873])
</pre></div>
</div>
</div>
</div>
<p>We will not move on from <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>. Before we do so, here’s an example of generating random integers between 0 and 10:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">randint</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([5, 0, 9, 6, 2, 0, 5])
</pre></div>
</div>
</div>
</div>
<p>And again with a random seed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">randint</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 6, 5, 4, 8, 9, 1])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">randint</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3445</span><span class="p">)</span> <span class="c1"># a different seed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([8, 1, 9, 6, 8, 6, 0])
</pre></div>
</div>
</div>
</div>
</section>
<section id="numerical-integration-using-scipy">
<h4>Numerical integration using  <code class="docutils literal notranslate"><span class="pre">scipy</span></code><a class="headerlink" href="#numerical-integration-using-scipy" title="Permalink to this headline">#</a></h4>
<p>OK, on to to and <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code>.</p>
<p>Numerical integration is the approximate computation of an integral using numerical techniques. You need numerical integration whenever you have a complicated function that cannot be integrated analytically using anti-derivatives. For example, calculating the area under a curve is a particularly useful application. Another one is solving ordinary differential equations (ODEs), commonly used for modelling biological systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">integrate</span>
</pre></div>
</div>
</div>
</div>
<section id="area-under-a-curve">
<h5>Area under a curve<a class="headerlink" href="#area-under-a-curve" title="Permalink to this headline">#</a></h5>
<p>Let’s calculate the area under an arbitrary curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="c1"># The y values; can also use a python list here</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize the curve. We can use the <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> package for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f529e907e50&gt;]
</pre></div>
</div>
<img alt="../_images/06-Python_II_96_1.png" src="../_images/06-Python_II_96_1.png" />
</div>
</div>
<p>Now compute the area using the <a class="reference external" href="https://en.wikipedia.org/wiki/Trapezoidal_rule">composite trapezoidal rule</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 173.0
</pre></div>
</div>
</div>
</div>
<p>The argument <code class="docutils literal notranslate"><span class="pre">dx</span></code> defines the spacing between points of the curve (the x-axis values). The default is 1 (don’t forget to check out the documentation: <code class="docutils literal notranslate"><span class="pre">?integrate.trapz</span></code>). Changing this will change the area, of course:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 86.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 259.5
</pre></div>
</div>
</div>
</div>
<p>Now, the same, using <a class="reference external" href="https://en.wikipedia.org/wiki/Simpson%27s_rule">Simpson’s rule</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 176.66666666666663
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 88.33333333333331
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;area =&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>area = 265.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-lotka-volterra-model">
<h5>The Lotka-Volterra model<a class="headerlink" href="#the-lotka-volterra-model" title="Permalink to this headline">#</a></h5>
<p>Now let’s try numerical integration in Python for solving a classical model in biology — the Lotka-Volterra (LV) model for a predator-prey system in two-dimensional space (e.g., on land). The LV model is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c31ff4e6-1dd1-43df-ae7d-e5a750d83e3f">
<span class="eqno">(2)<a class="headerlink" href="#equation-c31ff4e6-1dd1-43df-ae7d-e5a750d83e3f" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{dR}{dt} &amp;= r R - a C R  \nonumber \\
    \frac{dC}{dt} &amp;= - z C + e a C R
\end{align}\]</div>
<p>where,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(R\)</span> are consumer (e.g., predator) and resource (e.g., prey) population abundances (either number <span class="math notranslate nohighlight">\(\times\)</span> area<span class="math notranslate nohighlight">\(^{-1}\)</span> ).</p></li>
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the intrinsic (per-capita) growth rate of the resource population (time<span class="math notranslate nohighlight">\(^{-1}\)</span>).</p></li>
<li><p><span class="math notranslate nohighlight">\(a\)</span> is per-capita “search rate” for the resource (<span class="math notranslate nohighlight">\(\text{area}\times \text{time}^{-1}\)</span>)  multiplied by its attack success probability, which determines the encounter and consumption rate of the consumer on the resource.</p></li>
<li><p><span class="math notranslate nohighlight">\(z\)</span> is mortality rate (<span class="math notranslate nohighlight">\(\text{time}^{-1}\)</span>) and <span class="math notranslate nohighlight">\(e\)</span> is the consumer’s efficiency (a fraction) in converting resource to consumer biomass.</p></li>
</ul>
<p>We have already imported scipy above (<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">scipy</span> <span class="pre">as</span> <span class="pre">sc</span></code>) so we can proceed to solve the LV model using numerical integration.</p>
<p>First, import <code class="docutils literal notranslate"><span class="pre">scipy</span></code>’s <code class="docutils literal notranslate"><span class="pre">integrate</span></code> submodule:</p>
<p>Now define a function that returns the growth rate of consumer and resource population at any given time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dCR_dt</span><span class="p">(</span><span class="n">pops</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">pops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">pops</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dRdt</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">R</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">C</span> 
    <span class="n">dCdt</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span> <span class="o">*</span> <span class="n">C</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">C</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dRdt</span><span class="p">,</span> <span class="n">dCdt</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">dCR_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>function
</pre></div>
</div>
</div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">dCR_dt</span></code> has been stored as a function object in the current Python session, all ready to go.</p>
<p>Now assign some parameter values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span> 
<span class="n">z</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.75</span>
</pre></div>
</div>
</div>
</div>
<p>Define the time vector; let’s integrate from time point 0 to 15, using 1000 sub-divisions of time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the units of time are arbitrary here.</p>
<p>Set the initial conditions for the two populations (10 resources and 5 consumers per unit area), and convert the two into an array (because our <code class="docutils literal notranslate"><span class="pre">dCR_dt</span></code> function take an array as input).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">C0</span> <span class="o">=</span> <span class="mi">5</span> 
<span class="n">RC0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R0</span><span class="p">,</span> <span class="n">C0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now numerically integrate this system forward from those starting conditions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pops</span><span class="p">,</span> <span class="n">infodict</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">odeint</span><span class="p">(</span><span class="n">dCR_dt</span><span class="p">,</span> <span class="n">RC0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pops</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[10.        ,  5.        ],
       [10.07578091,  4.94421976],
       [10.1529783 ,  4.88948321],
       ...,
       [ 9.99869712, 17.56204194],
       [ 9.8872779 , 17.3642589 ],
       [ 9.78000354, 17.16658946]])
</pre></div>
</div>
</div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">pops</span></code> contains the result (the population trajectories).  Also check what’s in infodict (it’s a  dictionary with additional information)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">infodict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infodict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;hu&#39;, &#39;tcur&#39;, &#39;tolsf&#39;, &#39;tsw&#39;, &#39;nst&#39;, &#39;nfe&#39;, &#39;nje&#39;, &#39;nqu&#39;, &#39;imxer&#39;, &#39;lenrw&#39;, &#39;leniw&#39;, &#39;mused&#39;, &#39;message&#39;])
</pre></div>
</div>
</div>
</div>
<p>Check what the <code class="docutils literal notranslate"><span class="pre">infodict</span></code> output is by reading the help documentation with <code class="docutils literal notranslate"><span class="pre">?scipy.integrate.odeint</span></code>. For example, you can return a message to screen about whether the integration was successful:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infodict</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Integration successful.&#39;
</pre></div>
</div>
</div>
</div>
<p>So it worked, great!</p>
<p>But we would like to visualize the results. Let’s do it using the <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> package.</p>
<p>Again, to visualize the results of your numerical simulations in Python (or for data exploration/analyses), you can use <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, which uses Matlab like plotting syntax.</p>
<p>First import the package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">p</span>
</pre></div>
</div>
</div>
</div>
<p>Now open an empty figure object (analogous to an R graphics object).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pops</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resource density&#39;</span><span class="p">)</span> <span class="c1"># Plot</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pops</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Consumer density&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Population density&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Consumer-Resource population dynamics&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><span class="c1"># To display the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/06-Python_II_129_0.png" src="../_images/06-Python_II_129_0.png" />
</div>
</div>
<p>Finally, save the figure as a pdf:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../results/LV_model.pdf&#39;</span><span class="p">)</span> <span class="c1">#Save figure</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use many other graphics output formats in matplotlib; check the documentation of <code class="docutils literal notranslate"><span class="pre">p.savefig</span></code>.</p>
</div>
</section>
</section>
</section>
<section id="practicals">
<h3>Practicals<a class="headerlink" href="#practicals" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>Create a self-standing script using the above example and save it as <code class="docutils literal notranslate"><span class="pre">LV1.py</span></code> in your code directory. In addition to generating the above figure, it should also generate the following figure:</p></li>
</ol>
<hr class="docutils" />
<figure class="align-default" id="lv-phase-plot">
<a class="reference internal image-reference" href="../_images/LV_model_CR.png"><img alt="Lotka-Volterra phase plot" src="../_images/LV_model_CR.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text"><strong>Generate this figure as part of the <code class="docutils literal notranslate"><span class="pre">LV1.py</span></code> script.</strong></span><a class="headerlink" href="#lv-phase-plot" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>It should save both figures in pdf to the <code class="docutils literal notranslate"><span class="pre">results</span></code> directory, <em>without displaying them on screen</em>.</p>
</section>
<section id="the-need-for-speed-profiling-code">
<h3>The need for speed: profiling code<a class="headerlink" href="#the-need-for-speed-profiling-code" title="Permalink to this headline">#</a></h3>
<p>Donald Knuth says: <em>Premature optimization is the root of all evil</em>.</p>
<p>Indeed, computational speed may not be your initial concern. Also, you should focus on developing clean, reliable, reusable code rather than worrying first about how fast your code runs. However, speed will become an issue when and if your analysis or modeling becomes complex enough (e.g., food web or large network simulations). In that case, knowing which parts of your code take the most time is useful – optimizing those parts may save you lots of time.</p>
<section id="profiling">
<h4>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">#</a></h4>
<p>To find out what is slowing down your code you need to “profile” your code: locate the sections of your code where  speed bottlenecks exist.</p>
<p>Profiling is easy in <code class="docutils literal notranslate"><span class="pre">ipython</span></code> – simply use the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="n">your_function_name</span>
</pre></div>
</div>
<p>Let’s write an illustrative program (name it <code class="docutils literal notranslate"><span class="pre">profileme.py</span></code>) and run it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_squares</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">my_join</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">run_my_funcs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">my_squares</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">my_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">run_my_funcs</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span><span class="s2">&quot;My string&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10000000 My string
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>Look carefully at what each of these functions does.</p>
<p>Now run the script with <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">-p</span> <span class="pre">profileme.py</span></code>, and you should see something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>        <span class="m">20000063</span> <span class="k">function</span> calls <span class="o">(</span><span class="m">20000062</span> primitive calls<span class="o">)</span> <span class="k">in</span> <span class="m">9</span>.026 seconds

   Ordered by: internal <span class="nb">time</span>

   ncalls  tottime  percall  cumtime  percall filename:lineno<span class="o">(</span><span class="k">function</span><span class="o">)</span>
        <span class="m">1</span>    <span class="m">3</span>.335    <span class="m">3</span>.335    <span class="m">3</span>.732    <span class="m">3</span>.732 profileme.py:1<span class="o">(</span>my_squares<span class="o">)</span>
        <span class="m">1</span>    <span class="m">2</span>.698    <span class="m">2</span>.698    <span class="m">5</span>.200    <span class="m">5</span>.200 profileme.py:7<span class="o">(</span>my_join<span class="o">)</span>
 <span class="m">10000001</span>    <span class="m">2</span>.502    <span class="m">0</span>.000    <span class="m">2</span>.502    <span class="m">0</span>.000 <span class="o">{</span>method <span class="s1">&#39;join&#39;</span> of <span class="s1">&#39;str&#39;</span> objects<span class="o">}</span>
 <span class="m">10000008</span>    <span class="m">0</span>.397    <span class="m">0</span>.000    <span class="m">0</span>.397    <span class="m">0</span>.000 <span class="o">{</span>method <span class="s1">&#39;append&#39;</span> of <span class="s1">&#39;list&#39;</span> objects<span class="o">}</span>
        <span class="m">1</span>    <span class="m">0</span>.093    <span class="m">0</span>.093    <span class="m">9</span>.025    <span class="m">9</span>.025 profileme.py:13<span class="o">(</span>run_my_funcs<span class="o">)</span>
<span class="o">[</span>more output<span class="o">]</span>
</pre></div>
</div>
<p>The column headings in the profiling results are:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Column name</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">filename:lineno(function)</span></code></p></td>
<td><p>The filename, line number, and function name</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">ncalls</span></code></p></td>
<td><p>Number of times the function was called</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">tottime</span></code></p></td>
<td><p>Total time spent in the function (excluding time spent in calls to sub-functions of that function)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">percall</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tottime</span></code> divided by <code class="docutils literal notranslate"><span class="pre">ncalls</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">cumtime</span></code></p></td>
<td><p>Cumulative time spent in the function <em>and</em> all its sub-functions</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">percall</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cumtime</span></code> divided by <code class="docutils literal notranslate"><span class="pre">ncalls</span></code></p></td>
</tr>
</tbody>
</table>
<p>(Please also see the official Python <a class="reference external" href="https://docs.python.org/3.6/library/profile.html">documentation</a>)</p>
<p>The difference between <code class="docutils literal notranslate"><span class="pre">tottime</span></code> and <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> columns often holds the most important information about performance. For example, in the above output, <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> is much higher than <code class="docutils literal notranslate"><span class="pre">tottime</span></code> for <code class="docutils literal notranslate"><span class="pre">my_join</span></code> than for <code class="docutils literal notranslate"><span class="pre">my_squares</span></code>. This is because the sub-function (method) <code class="docutils literal notranslate"><span class="pre">join</span></code> is taking an additional 2.502 seconds (due to 10000001 calls), giving a <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> of 2.698 + 2.502 = 5.2 seconds. In comparison, the sub-function (method) <code class="docutils literal notranslate"><span class="pre">append</span></code> is taking an additional 0.397 seconds (due to 10000008 calls), giving a <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> of 3.335 + 0.397 = 3.732 seconds. Note also that the <code class="docutils literal notranslate"><span class="pre">tottime</span></code>s for <code class="docutils literal notranslate"><span class="pre">join</span></code> and <code class="docutils literal notranslate"><span class="pre">append</span></code> include the “overhead” of running their respective loop.</p>
<p>Thus, we can infer that the <code class="docutils literal notranslate"><span class="pre">my_join</span></code> function is hogging most of the time, followed by <code class="docutils literal notranslate"><span class="pre">my_squares</span></code>, and furthermore, that its the string method <code class="docutils literal notranslate"><span class="pre">join</span></code> that is slowing <code class="docutils literal notranslate"><span class="pre">my_join</span></code> down, and list method <code class="docutils literal notranslate"><span class="pre">append</span></code> that is slowing <code class="docutils literal notranslate"><span class="pre">my_squares</span></code> down. In other words, <code class="docutils literal notranslate"><span class="pre">.join</span></code>ing the string, and <code class="docutils literal notranslate"><span class="pre">.append</span></code>ing values to a list repeatedly are both not particularly fast, though the latter is less costly.</p>
<p>Can we do better? <em>Yes!</em></p>
<p>Let’s try this alternative approach to writing the program (save it as <code class="docutils literal notranslate"><span class="pre">profileme2.py</span></code>, and again, run it):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_squares</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">my_join</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">string</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">run_my_funcs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">my_squares</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">my_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">run_my_funcs</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span><span class="s2">&quot;My string&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10000000 My string
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>We did two things: converted the loop to a list comprehension, and replaced the <code class="docutils literal notranslate"><span class="pre">.join</span></code> with an explicit string concatenation.</p>
<p>Now profile this program (<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">-p</span> <span class="pre">profileme2.py</span></code>), and you should get something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>        <span class="m">64</span> <span class="k">function</span> calls <span class="o">(</span><span class="m">63</span> primitive calls<span class="o">)</span> <span class="k">in</span> <span class="m">4</span>.585 seconds

   Ordered by: internal <span class="nb">time</span>

   ncalls  tottime  percall  cumtime  percall filename:lineno<span class="o">(</span><span class="k">function</span><span class="o">)</span>
        <span class="m">1</span>    <span class="m">2</span>.497    <span class="m">2</span>.497    <span class="m">2</span>.497    <span class="m">2</span>.497 profileme2.py:2<span class="o">(</span>&lt;listcomp&gt;<span class="o">)</span>
        <span class="m">1</span>    <span class="m">1</span>.993    <span class="m">1</span>.993    <span class="m">1</span>.993    <span class="m">1</span>.993 profileme2.py:5<span class="o">(</span>my_join<span class="o">)</span>
        <span class="m">1</span>    <span class="m">0</span>.094    <span class="m">0</span>.094    <span class="m">4</span>.584    <span class="m">4</span>.584 profileme2.py:11<span class="o">(</span>run_my_funcs<span class="o">)</span>
<span class="o">[</span>more output<span class="o">]</span>
</pre></div>
</div>
<p>Woo hoo! So we about halved the time! Not quite enough to grab a pint, but ah well…</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Another approach would be to preallocate a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array instead of using a list for <code class="docutils literal notranslate"><span class="pre">my_squares</span></code> - <em>Try it</em></p>
<p>You can also modify how the profiling results are displayed, and more, by using flags. For example, <code class="docutils literal notranslate"><span class="pre">-s</span></code> allows sorting the report by a particular column,  <code class="docutils literal notranslate"><span class="pre">-l</span></code>  limits the number of lines displayed or filters the results by function name, and <code class="docutils literal notranslate"><span class="pre">-T</span></code> saves the report in a text file.</p>
<p>For example, try</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">s</span> <span class="n">cumtime</span> <span class="n">profileme2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will do the profiling and display the results sorted by <code class="docutils literal notranslate"><span class="pre">cumtime</span></code>.</p>
</section>
<section id="profiling-without-ipython">
<h4>Profiling without ipython<a class="headerlink" href="#profiling-without-ipython" title="Permalink to this headline">#</a></h4>
<p>You may want to execute the code that you need to profile from outside IPython (e.g., using a bash script). In this case, we you can use the module cProfile (ipython actually uses this when you do <code class="docutils literal notranslate"><span class="pre">%run</span> <span class="pre">-p</span></code>).</p>
<p>here is an example (run from bash):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m cProfile profileme2.py
</pre></div>
</div>
<p>Or,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m cProfile -o profires myscript.py
</pre></div>
</div>
<p>Here the results are stored in a file called <code class="docutils literal notranslate"><span class="pre">profires</span></code>, which can be read using the <code class="docutils literal notranslate"><span class="pre">pstats</span></code> module. Read the documentation of <code class="docutils literal notranslate"><span class="pre">cProfile</span></code> and <code class="docutils literal notranslate"><span class="pre">pstats</span></code> modules; there are many analyses you can perform on such exported  profiling reports.</p>
</section>
<section id="quick-profiling-with-timeit">
<h4>Quick profiling with <code class="docutils literal notranslate"><span class="pre">timeit</span></code><a class="headerlink" href="#quick-profiling-with-timeit" title="Permalink to this headline">#</a></h4>
<p>Additionally, you can use the <code class="docutils literal notranslate"><span class="pre">timeit</span></code> module if you want to figure out what the best way to do something specific as part of a larger program (say a particular command or a loop) might be.</p>
<p>Type and run the following code in a python script called <code class="docutils literal notranslate"><span class="pre">timeitme.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##############################################################################</span>
<span class="c1"># loops vs. list comprehensions: which is faster?</span>
<span class="c1">##############################################################################</span>

<span class="n">iters</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="kn">import</span> <span class="nn">timeit</span>

<span class="kn">from</span> <span class="nn">profileme</span> <span class="kn">import</span> <span class="n">my_squares</span> <span class="k">as</span> <span class="n">my_squares_loops</span>

<span class="kn">from</span> <span class="nn">profileme2</span> <span class="kn">import</span> <span class="n">my_squares</span> <span class="k">as</span> <span class="n">my_squares_lc</span>

<span class="c1">##############################################################################</span>
<span class="c1"># loops vs. the join method for strings: which is faster?</span>
<span class="c1">##############################################################################</span>

<span class="n">mystring</span> <span class="o">=</span> <span class="s2">&quot;my string&quot;</span>

<span class="kn">from</span> <span class="nn">profileme</span> <span class="kn">import</span> <span class="n">my_join</span> <span class="k">as</span> <span class="n">my_join_join</span>

<span class="kn">from</span> <span class="nn">profileme2</span> <span class="kn">import</span> <span class="n">my_join</span> <span class="k">as</span> <span class="n">my_join</span>

</pre></div>
</div>
<p>Note how we imported the functions using <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">profileme</span> <span class="pre">import</span> <span class="pre">my_squares</span> <span class="pre">as</span> <span class="pre">my_squares_loops</span></code>, etc., which highlights the convenience of Python’s elegant object-oriented approach.</p>
<p>Now run the two sets of comparisons using <code class="docutils literal notranslate"><span class="pre">timeit()</span></code> in ipython and make sure every line makes sense:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">my_squares_loops</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">my_squares_lc</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="p">(</span><span class="n">my_join_join</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">mystring</span><span class="p">))</span>
<span class="o">%</span><span class="n">timeit</span> <span class="p">(</span><span class="n">my_join</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">mystring</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that embedding the <code class="docutils literal notranslate"><span class="pre">%timeit()</span></code> commands within the script won’t work calling magic commands from inside a script is not a good idea!</p>
<p>Of course, a simple approach would have been to time the functions like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">my_squares_loops</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;my_squares_loops takes </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="si">}</span><span class="s2"> s to run.&quot;</span><span class="p">)</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">my_squares_lc</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;my_squares_lc takes </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="si">}</span><span class="s2"> s to run.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>But you’ll notice that if you run it multiple times, the time taken changes each time. So <code class="docutils literal notranslate"><span class="pre">timeit</span></code> takes a sample of runs and returns the average, which is better.</p>
<p><em>But remember, don’t go crazy with profiling for the sake of shaving a couple of milliseconds, tempting as that may be!</em></p>
</section>
</section>
<section id="vectorization-revisited">
<h3>Vectorization revisited<a class="headerlink" href="#vectorization-revisited" title="Permalink to this headline">#</a></h3>
<p>We have now had fairly extensive practice in iteratively creating solutions to problems using for loops. Thus far all our problems have been mathematically quite straightforward, and not very computationally intensive. As you begin to move on from your taught modules into project work, you may find yourselves solving larger and more complex problems, at which point you will start to discover that for-loops have a fundamental weakness - speed!</p>
<p>In a nutshell, there are two issues keeping loops slow:</p>
<ul class="simple">
<li><p>Producing solutions to a large problem one loop iteration at a time means that our scripts and functions spend a lot of time doing stuff other than actually solving the problem we want them to solve - e.g. shuffling data around between variables in each loop iteration, or storing the result of the current loop’s calculations in a (sometimes temporary) variable.</p></li>
<li><p>Loops (at least in Python) are not generally able to take advantage of the parallel computing capabilities of modern-day computers, and thus must literally compute a solution one loop iteration at a time. vectorized functions tend to be optimised to spread their computations over multiple processors/threads, which can be much faster!</p></li>
</ul>
<p>These issues become especially pronounced in the case of nested loops - which often appear in more spatially-explicit problems or time-dependent ones.</p>
<p>The following two examples will showcase the difference in runtime between a loop method and a vectorized method using numpy. The first is a relatively simple (if artificial) problem, intended to demonstrate basically at-a-glace the difference between the two approaches. The second is taken from current research on metabolic models of bacterial communities.</p>
<section id="an-example">
<h4>An example<a class="headerlink" href="#an-example" title="Permalink to this headline">#</a></h4>
<p>Let us imagine we have two simple 1D arrays <span class="math notranslate nohighlight">\(a = (a_1, a_2, ... , a_N)\)</span> and <span class="math notranslate nohighlight">\(b = (b_1, b_2, ... ,b_N)\)</span>, each of length N, and that we want to calculate a new array <span class="math notranslate nohighlight">\(c\)</span> in which each entry is just the product of the two corresponding entries in <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>:</p>
<div class="math notranslate nohighlight">
\[c = (a_1 \times b_1, a_2 \times b_2, ... , a_N \times b_N)\]</div>
<p>This operation is called the <em>entrywise</em> product of <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.</p>
<p>Below are a loop-based function and a vectorized function to calculate the entrywise product of two 1D arrays of the same length. We will test them both on larger and larger 1D arrays to see how the vectorized approach is faster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">loop_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   
    <span class="k">return</span> <span class="n">c</span>


<span class="k">def</span> <span class="nf">vect_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">multiply</span></code> function from numpy is a vectorized implementation of the elementwise product that we have explicitly written in the function <code class="docutils literal notranslate"><span class="pre">loop_product</span></code> above it. In general, numpy is an excellent choice for vectorized implementations of functions involving matrix maths (or maths using higher-dimensional analogues of matricies).</p>
<p>Let’s try comparing the runtimes of <code class="docutils literal notranslate"><span class="pre">loop_product</span></code> and <code class="docutils literal notranslate"><span class="pre">vect_product</span></code> on increasingly large randomly-generated 1D arrays:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">array_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">]</span>
<span class="n">t_loop</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">t_vect</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">array_lengths</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Set </span><span class="si">{</span><span class="n">N</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1">#randomly generate our 1D arrays of length N</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># time loop_product 3 times and save the mean execution time.</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;loop_product(a, b)&#39;</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">t_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timer</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loop method took </span><span class="si">{</span><span class="n">t_loop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms on average.&quot;</span><span class="p">)</span>
    
    <span class="c1"># time vect_product 3 times and save the mean execution time.</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;vect_product(a, b)&#39;</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">t_vect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timer</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vectorized method took </span><span class="si">{</span><span class="n">t_vect</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms on average.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set N=1
Loop method took 0.003620050847530365 ms on average.
vectorized method took 0.003780052065849304 ms on average.

Set N=100
Loop method took 0.04071998409926891 ms on average.
vectorized method took 0.0021600164473056793 ms on average.

Set N=10000
Loop method took 4.180800030007958 ms on average.
vectorized method took 0.01801997423171997 ms on average.

Set N=1000000
Loop method took 420.85887999273837 ms on average.
vectorized method took 0.9459999855607748 ms on average.

Set N=10000000
Loop method took 4280.039419978857 ms on average.
vectorized method took 175.6502800155431 ms on average.
</pre></div>
</div>
</div>
</div>
<p>Phew! That last one just exploded in terms of the time it took!</p>
<p>Now let’s compare the timings on a plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">array_lengths</span><span class="p">,</span> <span class="n">t_loop</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;loop method&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">array_lengths</span><span class="p">,</span> <span class="n">t_vect</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;vect method&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Array length&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Execution time (ms)&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/06-Python_II_147_0.png" src="../_images/06-Python_II_147_0.png" />
</div>
</div>
</section>
<section id="when-to-vectorize">
<h4>When to vectorize?<a class="headerlink" href="#when-to-vectorize" title="Permalink to this headline">#</a></h4>
<p>Thus vectorizing your code can have it running in a fraction of the time it otherwise would. Why not always vectorize then?</p>
<p>Generally, you should follow the same principles as with any code profiling: don’t spend time speeding up code that isn’t slow in the first place, or code which you will probably not need to run more than a small number of times.</p>
</section>
<section id="no-free-lunch">
<h4>“No free lunch!”<a class="headerlink" href="#no-free-lunch" title="Permalink to this headline">#</a></h4>
<p>There are trade-offs to vectorizing, most notably memory usage. One downside of calculating many steps simultaneously is that your computer needs to hold much more in memory in order to do it. If you try to vectorize a problem thats <em>too</em> large, you will probably run into memory errors. One easy example is to re-run the above example, but make it <strong>even bigger</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000000</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">vect_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># if no error, remove a, b, c from memory.</span>
<span class="k">del</span> <span class="n">a</span>
<span class="k">del</span> <span class="n">b</span>
<span class="k">del</span> <span class="n">c</span>
</pre></div>
</div>
<p>This will almost certainly return a memory error (i.e. your computer ran out of RAM in which to store the entirety of the very large arrays <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(c\)</span> while it was still calculating (if you didn’t get an error, try again with an extra 0 in <span class="math notranslate nohighlight">\(N\)</span>).</p>
<p>Again, this is a rather contrived example - you probably won’t be taking element-wise products of arrays with a billion entries in your research - but more complex problems can easily become too big for memory while still remaining biologically reasonable!</p>
<p><em>Check out the CMEE module on High Performance Computing to learn about using Imperial College’s supercomputing cluster to run extremely large problems</em></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package for parallelizing your code on your own computer.</p>
</div>
</section>
</section>
<section id="id1">
<h3>Practicals<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<section id="lotka-volterra-model-problem">
<h4>Lotka-Volterra model problem<a class="headerlink" href="#lotka-volterra-model-problem" title="Permalink to this headline">#</a></h4>
<p>Copy and modify <code class="docutils literal notranslate"><span class="pre">LV1.py</span></code> into another script called <code class="docutils literal notranslate"><span class="pre">LV2.py</span></code> that has the following features:</p>
<ul class="simple">
<li><p>It takes arguments for the four LV model parameters <span class="math notranslate nohighlight">\(r\)</span>, <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(z\)</span> ,<span class="math notranslate nohighlight">\(e\)</span> from the command line:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LV2</span><span class="o">.</span><span class="n">py</span> <span class="n">arg1</span> <span class="n">arg2</span> <span class="o">...</span> <span class="n">etc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>It runs the Lotka-Volterra model with prey density dependence <span class="math notranslate nohighlight">\(r R \left(1 - \frac{R} {K}\right)\)</span>, which changes the coupled ODEs to,</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-8788e4cc-abbe-45c1-a67e-5fe4e3371506">
<span class="eqno">(3)<a class="headerlink" href="#equation-8788e4cc-abbe-45c1-a67e-5fe4e3371506" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{dR}{dt} &amp;= r R \left(1 - \frac{R} {K}\right) - a C R\\
    \frac{dC}{dt} &amp;= - z C + e a C R
\end{align}\]</div>
<ul class="simple">
<li><p>It saves the plot as <code class="docutils literal notranslate"><span class="pre">.pdf</span></code> in an appropriate location.</p></li>
<li><p>The chosen parameter values should show in the plot (e.g., <span class="math notranslate nohighlight">\(r = 1, a = .5 \)</span>, etc) You can change time length <span class="math notranslate nohighlight">\(t\)</span> too.</p></li>
<li><p>The parameters values should be adjusted such that both predator and prey persist with prey density dependence ( the final (non-zero) population values should be printed to screen).</p></li>
</ul>
<p>Also, include a script that runs both <code class="docutils literal notranslate"><span class="pre">LV1.py</span></code> and <code class="docutils literal notranslate"><span class="pre">LV2.py</span></code> with appropriate arguments. This script should also profile the two scripts and print the results to screen for each of the scripts using the <code class="docutils literal notranslate"><span class="pre">%run</span> <span class="pre">-p</span></code> approach. Look at and compare the speed bottlenecks in <code class="docutils literal notranslate"><span class="pre">LV1.py</span></code> and <code class="docutils literal notranslate"><span class="pre">LV2.py</span></code>. <em>Think about how you could further speed up the scripts.</em></p>
</section>
<section id="groupwork-practical-compare-r-and-python-vectorization">
<h4>Groupwork practical: Compare R and Python Vectorization<a class="headerlink" href="#groupwork-practical-compare-r-and-python-vectorization" title="Permalink to this headline">#</a></h4>
<p>Implement the Python versions of <code class="docutils literal notranslate"><span class="pre">Vectorize1.R</span></code>and <code class="docutils literal notranslate"> <span class="pre">Vectorize2.R</span></code> <a class="reference internal" href="07-R.html#r-vectorization"><span class="std std-ref">from the R Chapter</span></a> (call them <code class="docutils literal notranslate"><span class="pre">Vectorize1.py</span></code> and <code class="docutils literal notranslate"><span class="pre">Vectorize2.py</span></code> respectively). Then write a shell script that compares the computational speed of the four scripts. the script should display meaningful summary of the results in the terminal. In particular, it should print the timings of the equivalent R and Python functions (not just the timing of the R and Python scripts as a whole).</p>
</section>
<section id="groupwork-practical-discrete-time-lv-model">
<h4>Groupwork practical: Discrete time LV Model<a class="headerlink" href="#groupwork-practical-discrete-time-lv-model" title="Permalink to this headline">#</a></h4>
<p><em>Write every subsequent extra credit script file with a new name such as <code class="docutils literal notranslate"><span class="pre">LV3.py</span></code>,<code class="docutils literal notranslate"><span class="pre">LV4.py</span></code>, etc.</em></p>
<ul class="simple">
<li><p>Write a discrete-time version of the LV model called <code class="docutils literal notranslate"><span class="pre">LV3.py</span></code>. The discrete-time model is:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-53b8a667-19b8-46cc-bd19-02e1078d70c0">
<span class="eqno">(4)<a class="headerlink" href="#equation-53b8a667-19b8-46cc-bd19-02e1078d70c0" title="Permalink to this equation">#</a></span>\[\begin{align} 
    R_{t+1} &amp;= R_t (1 + r \left(1 - \frac{R_t}{K}\right) - a C_t)\\ 
    C_{t+1} &amp;= C_t (1 - z + e a R_t) 
\end{align}\]</div>
<p>Include this script in <code class="docutils literal notranslate"><span class="pre">run_LV.py</span></code>, and profile it as well.</p>
</section>
<section id="groupwork-practical-discrete-time-lv-model-with-stochasticity">
<h4>Groupwork practical: Discrete time LV model with stochasticity<a class="headerlink" href="#groupwork-practical-discrete-time-lv-model-with-stochasticity" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Write a version of the discrete-time model (which you implemented in <code class="docutils literal notranslate"><span class="pre">LV3.py</span></code>) simulation with a random gaussian fluctuation in resource’s growth rate at each time-step:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-5c048884-cbc7-4699-90d4-9ae7209d2d54">
<span class="eqno">(5)<a class="headerlink" href="#equation-5c048884-cbc7-4699-90d4-9ae7209d2d54" title="Permalink to this equation">#</a></span>\[\begin{align}
        R_{t+1} &amp;= R_t (1 + (r + \epsilon) \left(1 - \frac{R_t}{K}\right)- a C_t)\\
        C_{t+1} &amp;= C_t (1 - z + e a R_t)
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon\)</span> is a random fluctuation drawn from a gaussian distribution (use <code class="docutils literal notranslate"><span class="pre">sc.stats</span></code> or <code class="docutils literal notranslate"><span class="pre">np.random</span></code>). Include this script in <code class="docutils literal notranslate"> <span class="pre">run_LV.py</span></code>, and profile it as well. You can also add fluctuations to both populations simultaneously this way:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7f484e68-d430-4321-ae00-04ab790f2af3">
<span class="eqno">(6)<a class="headerlink" href="#equation-7f484e68-d430-4321-ae00-04ab790f2af3" title="Permalink to this equation">#</a></span>\[\begin{align}
    R_{t+1} &amp;= R_t (1 + (r + \epsilon)  \left(1 - \frac{R_t}{K}\right) - a C_t)\\
    C_{t+1} &amp;= C_t (1 - (z + \epsilon) + e a R_t)
\end{align}\]</div>
<p><em>As always, test, add, commit and push all your new code and data to your git repository.</em></p>
</section>
</section>
</section>
<section id="regular-expressions-in-python">
<span id="python-ii-python-regex"></span><h2>Regular expressions in Python<a class="headerlink" href="#regular-expressions-in-python" title="Permalink to this headline">#</a></h2>
<p>Let’s shift gears now, and look at a very important tool set that you should learn, or at least be aware of — <em>Regular expressions</em>.</p>
<p>Regular expressions (regex) are a tool to find patterns (not just a particular sequence of characters) in strings. For example, <code class="docutils literal notranslate"><span class="pre">your&#64;email.com</span></code> is a specific sequence of characters, but, in fact, all email addresses have such a pattern: alphanumeric characters, a “&#64;”, alphanumeric characters, a “.”, alphanumeric characters. Using regex, you can search for all email addresses in a text file by searching for this pattern.</p>
<p>There are many uses of regex, such as:</p>
<ul class="simple">
<li><p>Parsing (reading) text files and finding and replacing or deleting specific patterns</p></li>
<li><p>Finding DNA motifs in sequence data</p></li>
<li><p>Navigating through files in a directory</p></li>
<li><p>Extracting information from html and xml files</p></li>
</ul>
<p>Thus, if you are interested in data mining, need to clean or process data in any other way, or convert a bunch of information into usable data, knowing regex is absolutely necessary.</p>
<hr class="docutils" />
<figure class="align-default" id="xkcd-on-regex">
<a class="reference internal image-reference" href="../_images/regex.png"><img alt="XKCD on Regex" src="../_images/regex.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text"><strong>Regular expressions can really improve your quality of life.</strong><br> (Source: <a class="reference external" href="https://www.xkcd.com/208/">XKCD</a>)</span><a class="headerlink" href="#xkcd-on-regex" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>Regex packages are available for most programming languages (recall <a class="reference internal" href="01-Unix.html#using-grep"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">grep</span></code> in UNIX</span></a>; that is how regex first became popular).</p>
<section id="metacharacters-vs-regular-characters">
<h3>Metacharacters vs. regular characters<a class="headerlink" href="#metacharacters-vs-regular-characters" title="Permalink to this headline">#</a></h3>
<p>A regex may consist of a combination of special “metacharacters” (modifiers) and “regular” or literal characters. There are 14 metacharacters:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Metacharacter</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">[</span></code> <code class="docutils literal notranslate"><span class="pre">]</span></code></p></td>
<td class="text-align:left"><p>Used to enclose a specific character “class” — the set of characters that you wish to match. For example,  <code class="docutils literal notranslate"><span class="pre">[12]</span></code> means match target to “1” and if that does not match then match target to “2”; <code class="docutils literal notranslate"><span class="pre">[0-9]</span></code> means match to any character in range “0” to “9”</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\</span></code></p></td>
<td class="text-align:left"><p>Inhibits the “specialness” of a (meta)character so that it can be interpreted literally. So, for example, use <code class="docutils literal notranslate"><span class="pre">\.</span></code> to match an actual period, and  <code class="docutils literal notranslate"><span class="pre">\\</span></code> to match an actual back slash.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">.</span></code></p></td>
<td class="text-align:left"><p>Match any character except line break (newline); e.g.,	<code class="docutils literal notranslate"><span class="pre">he..o</span></code> will match <em>hello</em> as well as <em>he12o</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">^</span></code></p></td>
<td class="text-align:left"><p>Indicates that the string to be matched is at the start of a longer string; e.g., <code class="docutils literal notranslate"><span class="pre">^hello</span></code> will match “hello” in “hello fellow!”, but not in “fellow, hello!”</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">$</span></code></p></td>
<td class="text-align:left"><p>Match the end of a string; for example, <code class="docutils literal notranslate"><span class="pre">world$</span></code> will match “world” in “Hello world”, but not in “Hello world!”</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td class="text-align:left"><p>Match zero or more occurrences of the character or pattern that precedes it.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p></td>
<td class="text-align:left"><p>Match 1 or more occurrences of the character or pattern that precedes it.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">?</span></code></p></td>
<td class="text-align:left"><p>Match the preceding pattern element zero <em>or</em> one times</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">{</span></code> <code class="docutils literal notranslate"><span class="pre">}</span></code></p></td>
<td class="text-align:left"><p>Match exactly the specified number of occurrences; e.g., <code class="docutils literal notranslate"><span class="pre">.{2}</span></code> finds the first two instances of any character (except newline)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>`</p></td>
<td class="text-align:left"><p>`</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">(</span></code> <code class="docutils literal notranslate"><span class="pre">)</span></code></p></td>
<td class="text-align:left"><p>Capture and group; examples of this appear below</p></td>
</tr>
</tbody>
</table>
<p>Everything other than these metacharacters is interpreted literally (e.g., <em>a</em> is matched by entering <code class="docutils literal notranslate"><span class="pre">a</span></code> in the regex) – a regular character.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>The difference between <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, and <code class="docutils literal notranslate"><span class="pre">?</span></code></strong>:
<code class="docutils literal notranslate"><span class="pre">*</span></code> matches zero or more times, so whatever’s being repeated may <em>not</em> be present at all, while <code class="docutils literal notranslate"><span class="pre">+</span></code> <em>requires</em> at least one occurrence. So, for example, <code class="docutils literal notranslate"><span class="pre">ra+t</span></code> will match “rat” (one ‘a’ is present) and “raaat” (three “a”s), but won’t match “rt”. On the other hand, <code class="docutils literal notranslate"><span class="pre">?</span></code> matches a pattern either once or zero times, so it makes the pattern matching more flexible. For example, <code class="docutils literal notranslate"><span class="pre">home-?brew</span></code> matches either “homebrew” or “home-brew”.</p>
</div>
</section>
<section id="regex-special-sequences">
<h3>Regex special sequences<a class="headerlink" href="#regex-special-sequences" title="Permalink to this headline">#</a></h3>
<p>Along with inhibiting the “specialness” of a metacharacter so that it can be interpreted literally (see examples in table above), the backslash (<code class="docutils literal notranslate"><span class="pre">\</span></code>) can be followed by various standard character types to denote various <em>special sequences</em>.</p>
<p>Below is a list of <em>commonly encountered</em> special sequences in <a class="reference external" href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> string patterns. For a complete list look <a class="reference external" href="https://docs.python.org/3/library/re.html#re-syntax">here</a>.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Sequence</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\d</span></code></p></td>
<td class="text-align:left"><p>Matches any numeric (integer); this is equivalent to the regex class [0-9]</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\D</span></code></p></td>
<td class="text-align:left"><p>Matches any non-digit character not covered by <code class="docutils literal notranslate"> <span class="pre">\d</span></code> (i.e., match a non-digit); this is equivalent to the class [^0-9]</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\n</span></code></p></td>
<td class="text-align:left"><p>Matches a newline</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\t</span></code></p></td>
<td class="text-align:left"><p>Matches a tab space</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\s</span></code></p></td>
<td class="text-align:left"><p>Matches any whitespace character; this is equivalent to the class [ \t\n\r\f\v]</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\S</span></code></p></td>
<td class="text-align:left"><p>Matches any non-whitespace character; this is equivalent to the class [^ \t\n\r\f\v]</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\w</span></code></p></td>
<td class="text-align:left"><p>Matches any “alphanumeric” character (including underscore); this is equivalent to the class [a-zA-Z0-9_]</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\W</span></code></p></td>
<td class="text-align:left"><p>Matches any non-alphanumeric character not covered by <code class="docutils literal notranslate"><span class="pre">\w</span></code>, i.e., any non-alphanumeric character excluding underscore, such as <code class="docutils literal notranslate"><span class="pre">?</span></code>, <code class="docutils literal notranslate"><span class="pre">!</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, etc. ; this is equivalent to the class [^a-zA-Z0-9_]</p></td>
</tr>
</tbody>
</table>
<p>In the above table,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\r</span></code> stands for a “<a class="reference external" href="https://en.wikipedia.org/wiki/Carriage_return#Computers">carriage-return</a>”, which is usually (but not always) the same as as a newline (<code class="docutils literal notranslate"><span class="pre">\n</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\f</span></code> stands fior <a class="reference external" href="https://en.wikipedia.org/wiki/Page_break">“form feed”</a> (or a page break character)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\v</span></code> stands for  <a class="reference external" href="https://en.wikipedia.org/wiki/Whitespace_character">“vertical whitespace”</a>, which includes all characters treated as line breaks in the Unicode standard.</p></li>
</ul>
<p>These are rarely encountered, but can exist in certain text files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The reason why we have specified underscore as belonging to <code class="docutils literal notranslate"><span class="pre">\w</span></code> (i.e., the regex set [A-Za-z0-9_]) is because this is the specification of this class in Python regex in particular. This class definition is shared by most, but not all regex “flavors” (i.e., regex in other languages, such as Perl or Bash (recall <code class="docutils literal notranslate"><span class="pre">grep</span></code>)). The goal is to not to worry about it, but to keep in mind that <code class="docutils literal notranslate"><span class="pre">\w</span></code> will also match any pattern that includes one or more <code class="docutils literal notranslate"><span class="pre">_</span></code>’s!</p>
</div>
</section>
<section id="some-regex-examples">
<h3>Some regex examples<a class="headerlink" href="#some-regex-examples" title="Permalink to this headline">#</a></h3>
<p>So combining metacharacters, regular characters and special sequences allows you to find pretty much any pattern. Here are some examples:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Regex</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">aX9</span></code></p></td>
<td class="text-align:left"><p>match the character string <em>aX9</em> exactly (case sensitively)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">aX9\n</span></code></p></td>
<td class="text-align:left"><p>match the character string <em>aX9</em>  (case sensitively) followed by a newline</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td class="text-align:left"><p>match the number <em>8</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\d8</span></code></p></td>
<td class="text-align:left"><p>match the number <em>8</em> preceded by any decimal number</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">[atgc]</span></code></p></td>
<td class="text-align:left"><p>match any character listed: <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">t</span></code>, <code class="docutils literal notranslate"><span class="pre">g</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>`at</p></td>
<td class="text-align:left"><p>gc`</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">[^atgc]</span></code></p></td>
<td class="text-align:left"><p>match any character not listed: any character except <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">t</span></code>, <code class="docutils literal notranslate"><span class="pre">g</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">[^a-z]</span></code></p></td>
<td class="text-align:left"><p>match everything except lower case <em>a</em> to <em>z</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">[^Ff]</span></code></p></td>
<td class="text-align:left"><p>match anything except upper or lower case <em>f</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\w{n}</span></code></p></td>
<td class="text-align:left"><p>match the preceding pattern  element (any alphanumeric character) <em>exactly</em> <code class="docutils literal notranslate"><span class="pre">n</span></code> times</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\w{n,}</span></code></p></td>
<td class="text-align:left"><p>match the preceding pattern element (any alphanumeric character) <em>at least</em> <code class="docutils literal notranslate"><span class="pre">n</span></code> times</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\w{n,m}</span></code></p></td>
<td class="text-align:left"><p>match the preceding pattern element (any alphanumeric character) at least <code class="docutils literal notranslate"><span class="pre">n</span></code> but not more than <code class="docutils literal notranslate"><span class="pre">m</span></code> times</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Metacharacters are not active inside classes. For example, <code class="docutils literal notranslate"><span class="pre">[a-z$]</span></code> will match any of the characters <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">z</span></code>, but also <code class="docutils literal notranslate"><span class="pre">$</span></code>, because inside a character class it loses its special metacharacter status.</p>
</div>
</section>
<section id="regex-in-python">
<h3>Regex in Python<a class="headerlink" href="#regex-in-python" title="Permalink to this headline">#</a></h3>
<p>Regex functions in python are in the module <code class="docutils literal notranslate"><span class="pre">re</span></code>.</p>
<p>Let’s import it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<p>The simplest <code class="docutils literal notranslate"><span class="pre">python</span></code> regex function is <code class="docutils literal notranslate"><span class="pre">re.search</span></code>, which searches the string for match to a given pattern — returns a <em>match object</em> if a match is found and <code class="docutils literal notranslate"><span class="pre">None</span></code> if not. Thus, the command <code class="docutils literal notranslate"><span class="pre">match</span> <span class="pre">=</span> <span class="pre">re.search(pat,</span> <span class="pre">str)</span></code> finds matches of the pattern <code class="docutils literal notranslate"><span class="pre">pat</span></code> in the given string <code class="docutils literal notranslate"><span class="pre">str</span></code> and stores the search result in a variable named <code class="docutils literal notranslate"><span class="pre">match</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Always</strong> put <code class="docutils literal notranslate"><span class="pre">r</span></code> in front of your regex — it tells python to read the regex in its “raw” (literal) form. Without raw string notation (<code class="docutils literal notranslate"><span class="pre">r&quot;text&quot;</span></code>), every backslash (<code class="docutils literal notranslate"><span class="pre">\</span></code>) in a regular expression would have to be prefixed with another one to escape it. Read more about this <a class="reference external" href="https://docs.python.org/3.5/library/re.html">here</a>.</p>
</div>
<p>OK, let’s try some regexes (type all that follows in <code class="docutils literal notranslate"><span class="pre">regexs.py</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_string</span> <span class="o">=</span> <span class="s2">&quot;a given string&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Find a space in the string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s&#39;</span><span class="p">,</span> <span class="n">my_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;re.Match object; span=(1, 2), match=&#39; &#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>That’s only telling you that a match was found (the object was created successfully).</p>
<p>To see the match, use:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; &#39;
</pre></div>
</div>
</div>
</div>
<p>Now let’s try another pattern:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span> <span class="n">my_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>No surprise, because there are no numeric characters in our string!</p>
<p>To know whether a pattern was matched, we can use an <code class="docutils literal notranslate"><span class="pre">if</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s1">&#39;an example&#39;</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w*\s&#39;</span><span class="p">,</span> <span class="n">MyStr</span><span class="p">)</span> <span class="c1"># what pattern is this?</span>

<span class="k">if</span> <span class="n">match</span><span class="p">:</span>                      
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found a match:&#39;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> 
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;did not find a match&#39;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>found a match: an 
</pre></div>
</div>
</div>
</div>
<p>Here are some more regexes (add all that follows to <code class="docutils literal notranslate"><span class="pre">regexs.py</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;2&#39;</span> <span class="p">,</span> <span class="s2">&quot;it takes 2 to tango&quot;</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span> <span class="p">,</span> <span class="s2">&quot;it takes 2 to tango&quot;</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d.*&#39;</span> <span class="p">,</span> <span class="s2">&quot;it takes 2 to tango&quot;</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2 to tango&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s\w{1,3}\s&#39;</span><span class="p">,</span> <span class="s1">&#39;once upon a time&#39;</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; a &#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s\w*$&#39;</span><span class="p">,</span> <span class="s1">&#39;once upon a time&#39;</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; time&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s switch to a more compact syntax by directly returning the matched group (by directly appending <code class="docutils literal notranslate"><span class="pre">.group()</span></code> to the result).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w*\s\d.*\d&#39;</span><span class="p">,</span> <span class="s1">&#39;take 2 grams of H2O&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;take 2 grams of H2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\w*.*\s&#39;</span><span class="p">,</span> <span class="s1">&#39;once upon a time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c1"># &#39;once upon a &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;once upon a &#39;
</pre></div>
</div>
</div>
</div>
<p>Note that *, <code class="docutils literal notranslate"><span class="pre">+</span></code>, and <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> are all “greedy”:  They repeat the previous regex token as many times as possible.</p>
<p>As a result, they may match more text than you want. To make it non-greedy and terminate at the first found instance of a pattern, use <code class="docutils literal notranslate"><span class="pre">?</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\w*.*?\s&#39;</span><span class="p">,</span> <span class="s1">&#39;once upon a time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;once &#39;
</pre></div>
</div>
</div>
</div>
<p>To further illustrate greediness in regexes, let’s try matching an HTML tag:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.+&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;This is a &lt;EM&gt;first&lt;/EM&gt; test&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;EM&gt;first&lt;/EM&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>But we wanted just <code class="docutils literal notranslate"><span class="pre">&lt;EM&gt;</span></code>!</p>
<p>It’s because <code class="docutils literal notranslate"><span class="pre">+</span></code> is greedy. Instead, we can make <code class="docutils literal notranslate"><span class="pre">+</span></code> “lazy”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.+?&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;This is a &lt;EM&gt;first&lt;/EM&gt; test&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;EM&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>OK, moving on from greed and laziness…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d*\.?\d*&#39;</span><span class="p">,</span><span class="s1">&#39;1432.75+60.22i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1432.75&#39;
</pre></div>
</div>
</div>
</div>
<p>Note <code class="docutils literal notranslate"><span class="pre">\</span></code> before the <code class="docutils literal notranslate"><span class="pre">.</span></code>, to be able to find a literal <code class="docutils literal notranslate"><span class="pre">.</span></code></p>
<p>Otherwise, <code class="docutils literal notranslate"><span class="pre">re.search</span></code> will consider it to be a regex element (<code class="docutils literal notranslate"><span class="pre">.</span></code> means “match any character except newline”).</p>
<p>A couple more examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[AGTC]+&#39;</span><span class="p">,</span> <span class="s1">&#39;the sequence ATTCGT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ATTCGT&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+[A-Z]\w+\s*\w+&#39;</span><span class="p">,</span> <span class="s2">&quot;The bird-shit frog&#39;s name is Theloderma asper.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; Theloderma asper&#39;
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<figure class="align-default" id="theloderma-asper">
<a class="reference internal image-reference" href="../_images/thelodermaasper.JPG"><img alt="Bird-shit Frog" src="../_images/thelodermaasper.JPG" style="width: 350px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text"><strong>In case you were wondering what <em>Theloderma asper</em>, the “bird-shit frog”, looks like.</strong> Samraat snapped this one in a North-East Indian rainforest ages ago.</span><a class="headerlink" href="#theloderma-asper" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>How about looking for email addresses in a string? For example, let’s try matching a string consisting of an academic’s name, email address and research area or interest (no need to type this into any python file):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s1">&#39;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory&#39;</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\w\s]+,\s[\w\.@]+,\s[\w\s]+&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory&#39;
</pre></div>
</div>
</div>
</div>
<p>Note the use of <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>’s: for example, <code class="docutils literal notranslate"><span class="pre">[\w\s]</span></code> ensures that any combination of word characters and spaces is found.</p>
<p>Let’s see if this regex works on a different pattern of email addresses:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s1">&#39;Samraat Pawar, s-pawar@imperial.ac.uk, Systems biology and ecological theory&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\w\s]+,\s[\w\.@]+,\s[\w\s]+&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">275</span><span class="o">-</span><span class="mf">149e5</span><span class="n">ba466b2</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\w\s]+,\s[\w\.@]+,\s[\w\s]+&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

<span class="ne">AttributeError</span>: &#39;NoneType&#39; object has no attribute &#39;group&#39;
</pre></div>
</div>
</div>
</div>
<p>Nope! So let’s make the email address part of the regex more robust:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\w\s]+,\s[\w\.-]+@[\w\.-]+,\s[\w\s]+&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Samraat Pawar, s-pawar@imperial.ac.uk, Systems biology and ecological theory&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="practicals-some-regexercises">
<h3>Practicals: Some RegExercises<a class="headerlink" href="#practicals-some-regexercises" title="Permalink to this headline">#</a></h3>
<p>The following exercises are not for submission as part of your coursework, but we will discuss them in class on a subsequent day.</p>
<ol class="simple">
<li><p>Try the regex we used above for finding names (<code class="docutils literal notranslate"><span class="pre">[\w\s]+</span></code>) for cases where the person’s name has something unexpected, like a <code class="docutils literal notranslate"><span class="pre">?</span></code> or a <code class="docutils literal notranslate"><span class="pre">+</span></code>. Does it work? How can you make it more robust?</p></li>
</ol>
<ul class="simple">
<li><p>Translate the following regular expressions into regular English:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">r'^abc[ab]+\s\t\d'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r'^\d{1,2}\/\d{1,2}\/\d{4}$'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r'\s*[a-zA-Z,\s]+\s*'</span></code></p></li>
</ul>
</li>
<li><p>Write a regex to match dates in format YYYYMMDD, making sure that:</p>
<ul>
<li><p>Only seemingly valid dates match (i.e., year greater than 1900)</p></li>
<li><p>First digit in month is either 0 or 1</p></li>
<li><p>First digit in day <span class="math notranslate nohighlight">\(\leq 3\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="grouping-regex-patterns">
<h3>Grouping regex patterns<a class="headerlink" href="#grouping-regex-patterns" title="Permalink to this headline">#</a></h3>
<p>You can group regex patterns into meaningful blocks using parentheses. Let’s look again at the example of finding  email addresses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s1">&#39;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory&#39;</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\w\s]+,\s[\w\.-]+@[\w\.-]+,\s[\w\s]+&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory&#39;
</pre></div>
</div>
</div>
</div>
<p>Without grouping the regex:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory&#39;
</pre></div>
</div>
</div>
</div>
<p>Now create groups using <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([\w\s]+),\s([\w\.-]+@[\w\.-]+),\s([\w\s&amp;]+)&quot;</span><span class="p">,</span><span class="n">MyStr</span><span class="p">)</span>
<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory
Samraat Pawar
s.pawar@imperial.ac.uk
Systems biology and ecological theory
</pre></div>
</div>
</div>
</div>
<p>Nice! This is very handy for extracting specific patterns from text data. Note that we excluded the <code class="docutils literal notranslate"><span class="pre">,</span></code>’s and the <code class="docutils literal notranslate"><span class="pre">\s</span></code>’s from the grouping parentheses because we don’t want them to be returned in the match group list.</p>
<p>Have a look at <code class="docutils literal notranslate"><span class="pre">re4.py</span></code> in the TheMulQuaBio’s code repository for more on parsing email addresses using regexes.</p>
</section>
<section id="useful-re-commands">
<h3>Useful <code class="docutils literal notranslate"><span class="pre">re</span></code> commands<a class="headerlink" href="#useful-re-commands" title="Permalink to this headline">#</a></h3>
<p>Here are some important functions in the <code class="docutils literal notranslate"><span class="pre">re</span></code> module:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Command</p></th>
<th class="text-align:left head"><p>What it does</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.search(reg,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Scans the string and finds the first match of the pattern, returning a <code class="docutils literal notranslate"><span class="pre">match</span></code> object if successful and <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.match(reg,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Like <code class="docutils literal notranslate"><span class="pre">re.search</span></code>, but only matches the beginning of the string.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.compile(reg)</span></code></p></td>
<td class="text-align:left"><p>Compiles (stores) a regular expression for repeated use, improving efficiency.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.split(ref,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Splits the text by the occurrence of the pattern described by the regular expression.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.findall(ref,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Like <code class="docutils literal notranslate"><span class="pre">re.search</span></code>, but returns a list of all matches. If groups are present, returns a list of groups.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.finditer(ref,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Like <code class="docutils literal notranslate"><span class="pre">re.findall</span></code>, but returns an iterator containing the match objects over which you can iterate. Useful for “crawling” efficiently through text till you find all necessary number of matches.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">re.sub(ref,</span> <span class="pre">repl,</span> <span class="pre">text)</span></code></p></td>
<td class="text-align:left"><p>Substitutes each non-overlapping occurrence of the match with the text in <code class="docutils literal notranslate"><span class="pre">repl</span></code>.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p></p></td>
</tr>
</tbody>
</table>
<p>Many of these commands also work on whole contents of files. We will look at an example of this below. Let us try some particularly useful applications of some of these commands.</p>
</section>
<section id="finding-all-matches">
<h3>Finding all matches<a class="headerlink" href="#finding-all-matches" title="Permalink to this headline">#</a></h3>
<p>Above we used re.search() to find the first match for a pattern. In many scenarios, you will need to find <em>all</em> the matches of a pattern. The function <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code> does precisely this and returns all matches as a list of strings, with each string representing one match.</p>
<p>Let’s try this on an extension of the email example above for some data with multiple addresses:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s2">&quot;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory; Another academic, a-academic@imperial.ac.uk, Some other stuff thats equally boring; Yet another academic, y.a_academic@imperial.ac.uk, Some other stuff thats even more boring&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code> returns a list of all the emails found:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emails</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\w\.-]+@[\w\.-]+&#39;</span><span class="p">,</span> <span class="n">MyStr</span><span class="p">)</span> 
<span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>s.pawar@imperial.ac.uk
a-academic@imperial.ac.uk
y.a_academic@imperial.ac.uk
</pre></div>
</div>
</div>
</div>
<p>Nice!</p>
</section>
<section id="finding-in-files">
<h3>Finding in files<a class="headerlink" href="#finding-in-files" title="Permalink to this headline">#</a></h3>
<p>You will generally be wanting to apply regex searches to whole files. You might be tempted to write a loop to iterate over the lines of the file, calling <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code> on each line. However, <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code> can return a list of all the matches in a single step.</p>
<p>Let’s try finding all species names that correspond to Oaks in a data file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/TestOaksData.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">found_oaks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Q[\w\s].*\s&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="n">found_oaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Quercus, robur\n&#39;, &#39;Quercus, cerris\n&#39;, &#39;Quercus, petraea\n&#39;]
</pre></div>
</div>
</div>
</div>
<p>This works because recall that <code class="docutils literal notranslate"><span class="pre">f.read()</span></code> returns the whole text of a file in a single string). Also, the file is closed after reading.</p>
</section>
<section id="groups-within-multiple-matches">
<h3>Groups within multiple matches<a class="headerlink" href="#groups-within-multiple-matches" title="Permalink to this headline">#</a></h3>
<p>Grouping pattern matches using <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">)</span></code> as you learned above, can be combined with <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code>. If the pattern includes <em>two or more</em> groups, then instead of returning a list of strings, <code class="docutils literal notranslate"><span class="pre">re.findall()</span></code> returns a list of tuples. Each tuple represents one match of the pattern, and inside the tuple is group(1), group(2), etc.</p>
<p>Let’s try it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyStr</span> <span class="o">=</span> <span class="s2">&quot;Samraat Pawar, s.pawar@imperial.ac.uk, Systems biology and ecological theory; Another academic, a.academic@imperial.ac.uk, Some other stuff thats equally boring; Yet another academic, y.a.academic@imperial.ac.uk, Some other stuff thats even more boring&quot;</span>

<span class="n">found_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([\w\s]+),\s([\w\.-]+@[\w\.-]+)&quot;</span><span class="p">,</span> <span class="n">MyStr</span><span class="p">)</span>
<span class="n">found_matches</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Samraat Pawar&#39;, &#39;s.pawar@imperial.ac.uk&#39;),
 (&#39; Another academic&#39;, &#39;a.academic@imperial.ac.uk&#39;),
 (&#39; Yet another academic&#39;, &#39;y.a.academic@imperial.ac.uk&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">found_matches</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Samraat Pawar&#39;, &#39;s.pawar@imperial.ac.uk&#39;)
(&#39; Another academic&#39;, &#39;a.academic@imperial.ac.uk&#39;)
(&#39; Yet another academic&#39;, &#39;y.a.academic@imperial.ac.uk&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-text-from-webpages">
<h3>Extracting text from webpages<a class="headerlink" href="#extracting-text-from-webpages" title="Permalink to this headline">#</a></h3>
<p>OK, let’s step up the ante here. How about extracting text from a web page to create your own data? Let’s try extracting data from <a class="reference external" href="https://www.imperial.ac.uk/silwood-park/academic-staff/">this page</a>.</p>
<p>You will need a new package <code class="docutils literal notranslate"><span class="pre">urllib3</span></code>. Install it, and import it (also <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">re</span></code> if needed).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span> <span class="c1"># open a connection</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.imperial.ac.uk/silwood-park/academic-staff/&#39;</span><span class="p">)</span> 
<span class="n">webpage_html</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">data</span> <span class="c1">#read in the webpage&#39;s contents</span>
</pre></div>
</div>
</div>
</div>
<p>This is returned as bytes (not strings).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">webpage_html</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bytes
</pre></div>
</div>
</div>
</div>
<p>So decode it (remember, the default decoding that this method applies is <em>utf-8</em>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">My_Data</span>  <span class="o">=</span> <span class="n">webpage_html</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="c1">#print(My_Data)</span>
</pre></div>
</div>
</div>
</div>
<p>That’s a lot of potentially useful information! Let’s extract all the names of academics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Dr\s+\w+\s+\w+&quot;</span>
<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="c1"># example use of re.compile(); you can also ignore case  with re.IGNORECASE </span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">My_Data</span><span class="p">):</span> <span class="c1"># example use of re.finditer()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dr Arkhat Abzhanov
Dr Arkhat Abzhanov
Dr Cristina Banks
Dr Martin Brazeau
Dr Martin Brazeau
Dr Lauren Cator
Dr Rob Ewers
Dr Rob Ewers
Dr Matteo Fumagalli
Dr Matteo Fumagalli
Dr Matteo Fumagalli
Dr Richard Gill
Dr Richard Gill
Dr Samraat Pawar
Dr Will Pearse
Dr Will Pearse
Dr Will Pearse
Dr Julia Schroeder
Dr Julia Schroeder
Dr Julia Schroeder
Dr Joseph Tobias
Dr Joseph Tobias
Dr Mike Tristem
Dr Mike Tristem
Dr Bonnie Waring
Dr Bonnie Waring
Dr Bonnie Waring
Dr Emma Cavan
Dr Emma Cavan
Dr Emma Caven
Dr Magda Charalambous
Dr Magda Charalambous
Dr Vassiliki Koufopanou
Dr David Orme
Dr James Rosindell
Dr Chris Wilson
Dr Oliver Windram
Dr Peter Graystock
Dr Peter Graystock
Dr Michael Themis
Dr Michael Themis
Dr Aurelio Malo
Dr Aurelio Malo
</pre></div>
</div>
</div>
</div>
<p>Again, nice! However, its’ not perfect.</p>
<p>You can improve this by:</p>
<ul class="simple">
<li><p>Extracting Prof names as well</p></li>
<li><p>Eliminating the repeated matches</p></li>
<li><p>Grouping to separate title from first and second names</p></li>
<li><p>Extracting names that have unexpected characters, such as in hyphenated names (a “-” in the name)</p></li>
</ul>
<p><em>Try making these improvements.</em></p>
<p>Of course, you can match and extract other types of patterns as well, such as urls and email addresses (though this example web page does not have email addresses).</p>
</section>
<section id="replacing-text">
<h3>Replacing text<a class="headerlink" href="#replacing-text" title="Permalink to this headline">#</a></h3>
<p>Using the same web page data, let’s try using the <code class="docutils literal notranslate"><span class="pre">re.sub</span></code> command on the same web page data (<code class="docutils literal notranslate"><span class="pre">My_Data</span></code>) to replace text:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">New_Data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\t&#39;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">My_Data</span><span class="p">)</span> <span class="c1"># replace all tabs with a space</span>
<span class="c1"># print(New_Data)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>Practicals<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<section id="blackbirds-problem">
<h4>Blackbirds problem<a class="headerlink" href="#blackbirds-problem" title="Permalink to this headline">#</a></h4>
<p>Complete the code <code class="docutils literal notranslate"><span class="pre">blackbirds.py</span></code> that you find in the <code class="docutils literal notranslate"><span class="pre">TheMulQuaBio</span></code> (necessary data file is also there).</p>
</section>
</section>
</section>
<section id="using-python-to-build-workflows">
<h2>Using Python to build workflows<a class="headerlink" href="#using-python-to-build-workflows" title="Permalink to this headline">#</a></h2>
<p>You can use python to build an automated data analysis or simulation workflow that involves multiple languages, especially the ones you have already learnt: R, <span class="math notranslate nohighlight">\(\LaTeX\)</span>, and UNIX bash. For example, you could, in theory, write a single Python script to generate and update your masters dissertation, tables, plots, and all. Python is ideal for building such workflows because it has packages for practically every purpose.</p>
<p><em>Thus this topic may be useful for your <a class="reference internal" href="Appendix-MiniProj.html"><span class="doc std std-doc">Miniproject</span></a>, which will involve building a reproducible computational workflow.</em></p>
<section id="using-subprocess">
<h3>Using <code class="docutils literal notranslate"><span class="pre">subprocess</span></code><a class="headerlink" href="#using-subprocess" title="Permalink to this headline">#</a></h3>
<p>For building a workflow in Python the <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> module is key. With this module you can run non-Python commands and scripts, obtain their outputs, and also crawl through and manipulate directories.</p>
<p>First, import the module (this is part of the python standard library, so you won’t need to install it):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
</pre></div>
</div>
</div>
</div>
<section id="running-processes">
<h4>Running processes<a class="headerlink" href="#running-processes" title="Permalink to this headline">#</a></h4>
<p>There are two main ways to run commands through subprocess: <code class="docutils literal notranslate"><span class="pre">run</span></code> (available in Python 3.5 onwards) for basic usage, and <code class="docutils literal notranslate"><span class="pre">Popen</span></code> (<code class="docutils literal notranslate"><span class="pre">P</span></code>rocess <code class="docutils literal notranslate"><span class="pre">open</span></code>) for more advanced usage. We will work directly with <code class="docutils literal notranslate"><span class="pre">popen</span></code> because <code class="docutils literal notranslate"><span class="pre">run()</span></code> is a wrapper around <code class="docutils literal notranslate"><span class="pre">Popen</span></code>. Using <code class="docutils literal notranslate"><span class="pre">Popen</span></code> directly gives more control over how the command is run, and how its input and output are processed.</p>
<p>Let’s try running some commands in the UNIX bash.</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> In a terminal, first <code class="docutils literal notranslate"><span class="pre">cd</span></code> to your <code class="docutils literal notranslate"><span class="pre">code</span></code> directory,  launch <code class="docutils literal notranslate"><span class="pre">ipython3</span></code>, then and type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;I&#39;m talkin&#39; to you, bash!&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This creates an object <code class="docutils literal notranslate"><span class="pre">p</span></code>, from which you can extract the output and other information of the command you ran. Before we do anything more, let’s look at our <code class="docutils literal notranslate"><span class="pre">subprocess.popen</span></code> call carefully.</p>
<ul class="simple">
<li><p>The command line arguments were passed as a list of strings, which avoids the need for escaping quotes or other special characters that might be interpreted by the shell (for example, in this case, there are apostrophes in the string that is being <code class="docutils literal notranslate"><span class="pre">echo</span></code>ed in bash).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stdout</span></code> is the output from the process “spawned” by your command. This is a sequence of bytes (which you will need to decode - more on this below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stderr</span></code> is the error code (from which you can capture whether the process ran successfully or not). The method PIPE creates a new “pipe” (literally, a connection) to the output of to the “child”  process.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stderr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p>Nothing here, because the echo command does no return an any code. the <code class="docutils literal notranslate"><span class="pre">b</span></code> indicates that the output is in bits (unencoded). By default, stdout, stderr (and other outputs of <code class="docutils literal notranslate"><span class="pre">p.communicate</span></code>) are returned as binary (byte) format.</p>
<p>Now check what’s in <code class="docutils literal notranslate"><span class="pre">stdout</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stdout</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b&quot;I&#39;m talkin&#39; to you, bash!\n&quot;
</pre></div>
</div>
</div>
</div>
<p>Let’s encode and print it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I&#39;m talkin&#39; to you, bash!
</pre></div>
</div>
</div>
</div>
<p>You can also use a <code class="docutils literal notranslate"><span class="pre">universal_newlines</span> <span class="pre">=</span> <span class="pre">True</span></code> so that these outputs are returned as encoded text (default being <em>utf-8</em> usually), with  line endings converted to ‘\n’. For more information <a class="reference external" href="https://docs.python.org/3.5/library/subprocess.html">see the documentation</a>.</p>
<p>Let’s try something else:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-l&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now use <code class="docutils literal notranslate"><span class="pre">print(stdout.decode())</span></code> to see the output.</p>
<p>Recall that the <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code> command lists all files in a long listing format.</p>
<p>You can also call python itself from bash (!):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;python3&quot;</span><span class="p">,</span> <span class="s2">&quot;boilerplate.py&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span> <span class="c1"># A bit silly! </span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</pre></div>
</div>
<p>This should give you the output of your <code class="docutils literal notranslate"><span class="pre">boilerplate.py</span></code> script (remember, your current path will need to be in the appropriate code directory of the relevant week’s directory).</p>
<p>Similarly, to compile a <span class="math notranslate nohighlight">\(\LaTeX\)</span> document (using <code class="docutils literal notranslate"><span class="pre">pdflatex</span></code> in this case), you can do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;pdflatex yourlatexdoc.tex&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="handling-directory-and-file-paths">
<h3>Handling directory and file paths<a class="headerlink" href="#handling-directory-and-file-paths" title="Permalink to this headline">#</a></h3>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">subprocess.os</span></code> to make your code OS (Linux, Windows, Mac) independent. For example to assign paths:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="s1">&#39;subdirectory&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;directory/subdirectory/file&#39;
</pre></div>
</div>
</div>
</div>
<p>The result would be appropriately different on Windows (with backslashes instead of forward slashes).</p>
<p>Note that in all cases you can “catch” the output of <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> so that you can then use the output within your
python script. A simple example, where the output is a platform-dependent directory path, is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MyPath</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="s1">&#39;subdirectory&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>
<span class="n">MyPath</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;directory/subdirectory/file&#39;
</pre></div>
</div>
</div>
</div>
<p>Explore what <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> can do by tabbing
<code class="docutils literal notranslate"><span class="pre">subprocess.</span></code>, and also for submodules, e.g., type
<code class="docutils literal notranslate"><span class="pre">subprocess.os.</span></code> and then tab.</p>
</section>
<section id="running-r">
<h3>Running <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#running-r" title="Permalink to this headline">#</a></h3>
<p>R is likely an important part of your project’s analysis and data visualization components in particular — for example for statistical analyses and pretty plotting (<code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>!).</p>
<p>You can run <code class="docutils literal notranslate"><span class="pre">R</span></code> from Python easily. Try the following:</p>
<p><span class="math notranslate nohighlight">\(\star\)</span> Create an R script file called <code class="docutils literal notranslate"><span class="pre">TestR.R</span></code> in your <code class="docutils literal notranslate"><span class="pre">code</span></code> directory with the following content:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Hello, this is R!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, create a script <code class="docutils literal notranslate"><span class="pre">TestR.py</span></code> with the following content :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;Rscript --verbose TestR.R &gt; ../Results/TestR.Rout 2&gt; ../Results/TestR_errFile.Rout&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>Now run <code class="docutils literal notranslate"><span class="pre">TestR.py</span></code> (or <code class="docutils literal notranslate"><span class="pre">%cpaste</span></code>) and check<code class="docutils literal notranslate"><span class="pre">TestR.Rout</span></code> and <code class="docutils literal notranslate"><span class="pre">TestR_errorFile.Rout</span></code>.</p>
<p>Also check what happens if you run (type directly in <code class="docutils literal notranslate"><span class="pre">ipython</span></code> or <code class="docutils literal notranslate"><span class="pre">python</span></code> console):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;Rscript --verbose NonExistScript.R &gt; ../Results/outputFile.Rout 2&gt; ../Results/errorFile.Rout&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>What do you see on the screen?</p>
<p>Now open and check <code class="docutils literal notranslate"><span class="pre">outputFile.Rout</span></code>and `errorFile.Rout.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is possible that the location of <code class="docutils literal notranslate"><span class="pre">RScript</span></code> is different in your Unix/Linux system. To locate it, try <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/usr</span> <span class="pre">-name</span> <span class="pre">'Rscript'</span></code> in the bash terminal (not in Python!). For example, you might need to specify the path to it using <code class="docutils literal notranslate"><span class="pre">/usr/lib/R/bin/Rscript</span></code>.</p>
</div>
</section>
<section id="id3">
<h3>Practicals<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<p>As always, test, add, commit and push all your new code and data to your git repository.</p>
<section id="using-os-problem-1">
<h4>Using <code class="docutils literal notranslate"><span class="pre">os</span></code> problem 1<a class="headerlink" href="#using-os-problem-1" title="Permalink to this headline">#</a></h4>
<p>Open <code class="docutils literal notranslate"><span class="pre">using_os.py</span></code> and complete the tasks assigned (hint: you might want to look at <code class="docutils literal notranslate"><span class="pre">subprocess.os.walk()</span></code>)</p>
</section>
<section id="using-os-problem-2">
<h4>Using <code class="docutils literal notranslate"><span class="pre">os</span></code> problem 2<a class="headerlink" href="#using-os-problem-2" title="Permalink to this headline">#</a></h4>
<p>Open <code class="docutils literal notranslate"><span class="pre">fmr.R</span></code> and work out what it does; check that you have <code class="docutils literal notranslate"><span class="pre">NagyEtAl1999.csv</span></code>. Now write python code called
<code class="docutils literal notranslate"><span class="pre">run_fmr_R.py</span></code> that:</p>
<p>Runs <code class="docutils literal notranslate"><span class="pre">fmr.R</span></code> to generate the desired result</p>
<p><code class="docutils literal notranslate"><span class="pre">run_fmr_R.py</span></code> should also print to the python screen whether the run was successful, and the contents of the R console output</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">commit</span></code> and <code class="docutils literal notranslate"><span class="pre">push</span></code> all your week’s code by the given deadline.</p></li>
</ul>
</section>
</section>
</section>
<section id="networks-in-python">
<h2>Networks in Python<a class="headerlink" href="#networks-in-python" title="Permalink to this headline">#</a></h2>
<p>ALL biological systems have a network representation, consisting of nodes for the biological entities of interest, and edges or links for the relationships between them. Here are some examples:</p>
<ul class="simple">
<li><p>Metabolic networks</p></li>
<li><p>Gene regulatory networks</p></li>
<li><p>Individual-Individual (e.g., social networks)</p></li>
<li><p>Who-eats-whom (Food web) networks</p></li>
<li><p>Mutualistic (e.g., plant-pollinator) networks</p></li>
</ul>
<p><em>Can you think of a few more examples from biology?</em></p>
<p>You can easily simulate, analyze, and visualize biological networks in both <code class="docutils literal notranslate"><span class="pre">python</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span></code> using some nifty packages. A full network analysis tutorial is out of the scope of our Python module’s objectives, but let’s try a simple visualization using the <code class="docutils literal notranslate"> <span class="pre">networkx</span></code> python package.</p>
<p>For this you need to first install the package, for example, by using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install python3-networkx
</pre></div>
</div>
<section id="food-web-network-example">
<h3>Food web network example<a class="headerlink" href="#food-web-network-example" title="Permalink to this headline">#</a></h3>
<p>As an example, let’s plot a food web network.</p>
<p>The best way to store a food web dataset is as an “adjacency list” of who eats whom: a matrix with consumer name/id in 1st column, and resource name/id in 2nd column, and a separate matrix of species names/ids and properties such as biomass (node’s abundance), or average body mass. You will see what these data structures look like below.</p>
<p>First, import the necessary modules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">p</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s generate a “synthetic” food web. We can do this with the following function that generates a random adjacency list of a <span class="math notranslate nohighlight">\(N\)</span>-species food web with “connectance probability” <span class="math notranslate nohighlight">\(C\)</span>: the probability of having a link between any pair of species in the food web.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GenRdmAdjList</span><span class="p">(</span><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Ids</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">ALst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">:</span>
            <span class="n">Lnk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">Ids</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Lnk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Lnk</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1">#avoid self (e.g., cannibalistic) loops</span>
                <span class="n">ALst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Lnk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ALst</span>
</pre></div>
</div>
</div>
</div>
<p>Note that we are using a uniform random distribution between <code class="docutils literal notranslate"><span class="pre">[0,1]</span></code> to generate a connectance probability between each species pair.</p>
<p>Now assign number of species (<code class="docutils literal notranslate"><span class="pre">MaxN</span></code>) and connectance (<code class="docutils literal notranslate"><span class="pre">C</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MaxN</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">0.75</span>
</pre></div>
</div>
</div>
</div>
<p>Now generate an adjacency list representing a random food web:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AdjL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GenRdmAdjList</span><span class="p">(</span><span class="n">MaxN</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
<span class="n">AdjL</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 7, 10],
       [29,  8],
       [29,  6],
       [27, 25],
       [ 1, 29],
       [ 3, 11],
       [16, 12],
       [17, 24],
       [ 8, 26],
       [24,  5],
       [11, 14],
       [ 1, 19],
       [28, 16],
       [ 3,  8],
       [16,  0],
       [ 5, 24],
       [22, 21],
       [ 8, 26],
       [13, 19],
       [ 0, 23]])
</pre></div>
</div>
</div>
</div>
<p>So that’s what an adjacency list looks like. The two columns of numbers correspond to the consumer and resource ids, respectively.</p>
<p>Now generate species (node) data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Sps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">AdjL</span><span class="p">)</span> <span class="c1"># get species ids</span>
</pre></div>
</div>
</div>
</div>
<p>Now generate body sizes for the species. We will use a log<span class="math notranslate nohighlight">\(_{10}\)</span> scale because species body sizes tend to be <a class="reference external" href="08-Data_R.ipynb#Histograms">log-normally distributed</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SizRan</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span> <span class="c1">#use log10 scale</span>
<span class="n">Sizs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">SizRan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">SizRan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">MaxN</span><span class="p">)</span>
<span class="n">Sizs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-7.24580335, -6.34223605, -3.06433327, -4.14101734, -0.42383356,
        6.48230003, -7.46288577, -0.09210636, -0.30824046,  5.05976788,
        3.63763222, -8.47367241, -6.83922822,  3.79449561,  7.96727478,
        9.79412592, -9.78750357,  6.72700644,  4.14249903, -9.77200529,
       -5.89392611,  1.34223541,  6.41108343,  0.30499043,  5.6731972 ,
       -7.21906563, -6.02855067,  3.87331691,  9.14260337,  7.08389363])
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize the size distribution we have generated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Sizs</span><span class="p">)</span> <span class="c1">#log10 scale</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([3., 7., 1., 1., 3., 2., 3., 3., 4., 3.]),
 array([-9.78750357e+00, -7.82934062e+00, -5.87117767e+00, -3.91301472e+00,
        -1.95485177e+00,  3.31117768e-03,  1.96147413e+00,  3.91963707e+00,
         5.87780002e+00,  7.83596297e+00,  9.79412592e+00]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
<img alt="../_images/06-Python_II_271_1.png" src="../_images/06-Python_II_271_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">Sizs</span><span class="p">)</span> <span class="c1">#raw scale</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([28.,  0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.,  1.]),
 array([1.63115952e-10, 6.22480743e+08, 1.24496149e+09, 1.86744223e+09,
        2.48992297e+09, 3.11240371e+09, 3.73488446e+09, 4.35736520e+09,
        4.97984594e+09, 5.60232669e+09, 6.22480743e+09]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
<img alt="../_images/06-Python_II_272_1.png" src="../_images/06-Python_II_272_1.png" />
</div>
</div>
<p>Now let’s plot the network, with node sizes proportional to (log) body size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="c1"># close all open plot objects</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use a circular configuration. For this, we need to calculate the coordinates, easily done using networkx:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">Sps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">networkx.layout</span></code> for inbuilt functions to compute other types of node coordinates.</p>
<p>Now generate a networkx graph object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now add the nodes and links (edges) to it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">Sps</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">AdjL</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the function <code class="docutils literal notranslate"><span class="pre">add_edges_from</span></code> needs the adjacency list as a tuple.</p>
<p>Now generate node sizes that are proportional to (log) body sizes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NodSizs</span><span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">Sizs</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">Sizs</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Sizs</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">Sizs</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
<p>Now render (plot) the graph:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_size</span> <span class="o">=</span> <span class="n">NodSizs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/06-Python_II_285_0.png" src="../_images/06-Python_II_285_0.png" />
</div>
</div>
<p>You might get a warning. In that case, try upgrading the networkx package.</p>
</section>
<section id="id4">
<h3>Practicals<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<section id="plot-the-foodweb">
<h4>Plot the foodweb<a class="headerlink" href="#plot-the-foodweb" title="Permalink to this headline">#</a></h4>
<p>Type the above code for plotting a food web network in a program file called <code class="docutils literal notranslate"><span class="pre">DrawFW.py</span></code>. This file should save the plotted network as a pdf.</p>
</section>
<section id="groupwork-networks-in-r">
<h4>Groupwork: networks in R<a class="headerlink" href="#groupwork-networks-in-r" title="Permalink to this headline">#</a></h4>
<p>You can also do nice network visualizations in R. Here you will convert a network visualization script written in <code class="docutils literal notranslate"><span class="pre">R</span></code> using the <code class="docutils literal notranslate"><span class="pre">igraph</span></code> package to a python script that does the same thing.</p>
<ul class="simple">
<li><p>First copy the script file called <code class="docutils literal notranslate"><span class="pre">Nets.R</span></code> and the data files it calls and run it. This script visualizes the <a class="reference external" href="http://www.imperial.ac.uk/qmee-cdt">QMEE CDT collaboration network</a>, coloring the the nodes by the type of node (organization type: “University”,”Hosting Partner”, “Non-hosting Partner”).</p></li>
<li><p>Now, convert this script to a Python script that does the same thing, including writing to a <code class="docutils literal notranslate"><span class="pre">.svg</span></code> file using the same QMEE CDT link and node data. You can use <code class="docutils literal notranslate"><span class="pre">networkx</span></code> or some other python network visualization package.</p></li>
</ul>
</section>
</section>
</section>
<section id="readings-and-resources">
<h2>Readings and Resources<a class="headerlink" href="#readings-and-resources" title="Permalink to this headline">#</a></h2>
<section id="scientific-computing">
<h3>Scientific computing<a class="headerlink" href="#scientific-computing" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>In general, scores of good module/package-specific cookbooks are out there — google “cookbook” along with the name of the package you are interested in (e.g., “scipy cookbook”).</p></li>
<li><p>For SciPy, read the <a class="reference external" href="https://docs.scipy.org/doc/">official documentation</a>; in particular, read about the scipy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">modules</a> you think will be important to you.</p></li>
<li><p>The “ecosystem” for Scientific computing in python: <a class="reference external" href="http://www.scipy-lectures.org/">http://www.scipy-lectures.org/</a></p></li>
<li><p>Many great examples of applications in the <a class="reference external" href="https://scipy-cookbook.readthedocs.io/">scipy cookbook</a></p></li>
<li><p>Scipy stats: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/stats.html">https://docs.scipy.org/doc/scipy/reference/tutorial/stats.html</a></p></li>
<li><p>A Primer on Scientific Programming with Python <a class="reference external" href="http://www.springer.com/us/book/9783642549595">http://www.springer.com/us/book/9783642549595</a>; Multiple copies of this book are available from the central library and can be requested to Silwood from the IC library website. You can also find a pdf - seach online.</p></li>
</ul>
</section>
<section id="regular-expressions">
<h3>Regular expressions<a class="headerlink" href="#regular-expressions" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Python regex documentation: <a class="reference external" href="https://docs.python.org/3.6/howto/regex.html">https://docs.python.org/3.6/howto/regex.html</a></p></li>
<li><p>Google’s short class on regex in python: <a class="reference external" href="https://developers.google.com/edu/python/regular-expressions">https://developers.google.com/edu/python/regular-expressions</a>
And this exercise: <a class="reference external" href="https://developers.google.com/edu/python/exercises/baby-names">https://developers.google.com/edu/python/exercises/baby-names</a></p></li>
<li><p>Good intro to regex, tips and a great array of canned solutions: <a class="reference external" href="http://www.regular-expressions.info">http://www.regular-expressions.info</a></p></li>
<li><p>Use and abuse of regex: <a class="reference external" href="https://blog.codinghorror.com/regex-use-vs-regex-abuse/">https://blog.codinghorror.com/regex-use-vs-regex-abuse/</a></p></li>
</ul>
</section>
<section id="other-stuff">
<h3>Other stuff<a class="headerlink" href="#other-stuff" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://matplotlib.org">The matplotlib website</a></p></li>
<li><p>Alternatives to matplotlib for plotting in python: <a class="reference external" href="https://towardsdatascience.com/matplotlib-vs-seaborn-vs-plotly-f2b79f5bddb">https://towardsdatascience.com/matplotlib-vs-seaborn-vs-plotly-f2b79f5bddb</a></p></li>
<li><p>Some of you might find the python package <code class="docutils literal notranslate"><span class="pre">biopython</span></code> particularly useful — check out <a class="reference external" href="http://biopython.org/">http://biopython.org/</a>, and especially, the cookbook</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="07-R.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Biological Computing in R</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Stats-Intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to this section</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Samraat Pawar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>